<!DOCTYPE html><html><head>
      <title>Apuntes</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/jose/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.8.18/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview .caso_estudio {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .ejercicio {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#introducción" class="md-toc-link">
            <p>Introducción</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#primeros-scripts" class="md-toc-link"><p>Primeros SCRIPTS</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#scripts-en-mysql" class="md-toc-link">
            <p>SCRIPTS en MySQL</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#comentarios" class="md-toc-link">
            <p>Comentarios</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#variables-definidas-por-el-usuario" class="md-toc-link">
            <p>Variables definidas por el usuario</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#variables-del-sistema" class="md-toc-link"><p>Variables del sistema</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejecutar-scripts" class="md-toc-link">
            <p>Ejecutar scripts</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#procedimientos-y-estructuras-de-control" class="md-toc-link"><p>Procedimientos y estructuras de control</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#sintaxis-y-estructura" class="md-toc-link"><p>Sintaxis y Estructura</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#delimiter" class="md-toc-link">
            <p>DELIMITER</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bloques-de-código" class="md-toc-link">
            <p>Bloques de código</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#redefinir-y-eliminar" class="md-toc-link">
            <p>Redefinir y Eliminar</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#variables-locales-del-procedimiento" class="md-toc-link">
            <p>Variables locales del procedimiento</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#estructuras-de-control" class="md-toc-link"><p>Estructuras de control</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#estructuras-de-control-condicionales" class="md-toc-link">
            <p>Estructuras de control condicionales</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#estructuras-de-control-de-repetición" class="md-toc-link">
            <p>Estructuras de control de repetición</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#parámetros" class="md-toc-link">
            <p>Parámetros</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#funciones-predefinidas" class="md-toc-link"><p>Funciones predefinidas</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-matemáticas" class="md-toc-link">
            <p>Funciones matemáticas</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-de-cadenas-o-strings" class="md-toc-link">
            <p>Funciones de cadenas o strings</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-de-fechas" class="md-toc-link">
            <p>Funciones de fechas</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#funciones-avanzadas" class="md-toc-link"><p>Funciones avanzadas</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-avanzadas-para-mostrar-información" class="md-toc-link">
            <p>Funciones avanzadas para mostrar INFORMACIÓN</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-avanzadas-para-conversión-de-valores" class="md-toc-link">
            <p>Funciones avanzadas para CONVERSIÓN DE VALORES</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#funciones-avanzadas-para-programación" class="md-toc-link">
            <p>Funciones avanzadas para PROGRAMACIÓN</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#parámetros-de-entrada-salida" class="md-toc-link"><p>Parámetros de Entrada-Salida</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#parámetros-de-funciones-y-procedimientos" class="md-toc-link"><p>Parámetros de funciones y procedimientos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tipos-de-parámetros" class="md-toc-link">
            <p>Tipos de parámetros</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#funciones-definidas-por-el-usuario" class="md-toc-link">
            <p>Funciones definidas por el usuario</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#procedimientos-y-funciones-con-acceso-a-datos" class="md-toc-link"><p>Procedimientos y funciones con acceso a datos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#acceso-a-datos" class="md-toc-link">
            <p>Acceso a datos</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#acceso-a-datos-desde-funciones-definidas-por-el-usuario" class="md-toc-link">
            <p>Acceso a datos desde funciones definidas por el usuario</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#control-de-errores" class="md-toc-link">
            <p>Control de errores</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#comprobar-los-errores" class="md-toc-link">
            <p>Comprobar los errores</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#disparadores" class="md-toc-link"><p>Disparadores</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#triggers-que-realizan-acciones-derivadas-del-evento" class="md-toc-link">
            <p>Triggers que realizan acciones derivadas del evento</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#triggers-que-modifican-los-valores-recibidos-y-los-graba-correctamente" class="md-toc-link">
            <p>Triggers que modifican los valores recibidos y los graba correctamente</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#triggers-que-comprueban-que-los-valores-son-válidos" class="md-toc-link">
            <p>Triggers que comprueban que los valores son válidos</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#tablas-temporales" class="md-toc-link">
            <p>Tablas temporales</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#cursores" class="md-toc-link">
            <p>Cursores</p>

          </a></div>
</div>
<h2 id="introducción">Introducción </h2>
<p>Analizando el mercado actual de Bases de Datos, el uso de los diferentes productos existentes se ha segmentado.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Usuarios BD</th>
<th style="text-align:left">Bases de datos</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Grandes Empresas</strong></td>
<td style="text-align:left">La mayoría han apostado por Oracle por su seguridad y soporte.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Pequeñas y medianas Empresas (PYMES)</strong></td>
<td style="text-align:left">Aquí es donde más abierto está el mercado. Entre las más utilizadas están: Oracle Express, SQL Server de Microsoft, MySQL Server y PostgreSQL</td>
</tr>
<tr>
<td style="text-align:left"><strong>Pequeños negocios</strong></td>
<td style="text-align:left">Utilizan software propietario que utiliza SGBD con prestaciones de tipo ofimático como Microsoft Access.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Aplicaciones y páginas web</strong></td>
<td style="text-align:left">La mayoría de los proveedores de internet tienen incluido en sus ofertas MySQL y PostgreSQL, pero los usuarios suelen usar MySQL.</td>
</tr>
</tbody>
</table>
<p>Aunque los aspectos fundamentales a la forma de utilizar un SGBD son muy parecidos, en este curso nos hemos centrado en <strong>MySQL</strong>.</p>
<p>MySQL es un sistema de gestión de bases de datos SQL (SGBD DBMS) multihilo y multiusuario que tiene más de 10 millones de instalaciones según MySQL AB de Oracle (<a href="https://es.wikipedia.org/wiki/MySQL_AB">https://es.wikipedia.org/wiki/MySQL_AB</a>).</p>
<p>Las librerías para acceder a bases de datos MySQL están disponibles en los principales lenguajes de programación con APIs específicas de lenguaje. Además,una interfaz ODBC llamada MyODBC permite utilizar lenguajes de programación adicionales que soportan la interfaz ODBC para comunicarse con una base de datos MySQL. El servidor MySQL y las bibliotecas oficiales se implementan principalmente en ANSI C.</p>
<p>MySQL es popular para aplicaciones web y actúa como el componente de base de datos de las plataformas LAMP, MAMP y WAMP (Linux/Mac/Windows-Apache-MySQL-PHP/Perl). Su popularidad como aplicación web está estrechamente ligada a la popularidad de PHP, que a menudo se combina con MySQL. PHP y MySQL son componentes esenciales para ejecutar la popular plataforma de Gestor de Cotnenidos WordPress.</p>
<p><strong>Cliente / Servidor</strong><br>
La arquitectura <strong>cliente-servidor</strong> es un modelo de diseño de software en el que las tareas se reparten entre los proveedores de recursos o servicios, llamados servidores, y los demandantes, llamados clientes.</p>
<p>Un cliente realiza peticiones a otro programa, el servidor, quien le da respuesta. Esta idea también se puede aplicar a programas que se ejecutan sobre una sola computadora, aunque es más ventajosa en un sistema operativo multiusuario distribuido a través de una red de computadoras.</p>
<p>Cuando utilizamos un navegado en Internet y accedemos a un servidor mediante una dirección web, utilizamos el protocolo <strong>HTTP</strong> o <strong>HTTPS</strong> para enviar información del cliente al servidor y viceversa.</p>
<p>Tanto cliente como servidor ejecutan código y por lo tanto, procesan las instrucciones de programas y aplicaciones, y para ello se utilizan diferentes lenguajes de programación. A continuación se muestran algunos ejemplos:</p>
<p><img src=".img/6.1.1.png" alt="Imagen 6.1.1"></p>
<p>Puedes consultar el <strong>Tiobe Index</strong> de los lenguajes de programación más usados en: <a href="https://www.tiobe.com/tiobe-index/">https://www.tiobe.com/tiobe-index/</a></p>
<p>Puedes consultar la web del <strong>Instituto de Ingeniería Eléctrica y Electrónica</strong> (Institute of Electrical and Electronics Engineers o IEEE), que con más de 425.000 miembros y voluntarios en 160 países, también publica su propia lista de lenguajes de programación más populares (se puede filtrar por Web):<br>
<a href="https://spectrum.ieee.org/static/interactive-the-top-programming-languages-2018">https://spectrum.ieee.org/static/interactive-the-top-programming-languages-2018</a></p>
<p><strong>Programación en BD</strong><br>
Los SGBD relacionales usan SQL como lenguaje de DCL, DDL y DML.</p>
<ul>
<li><strong>DCL – Data Control Language</strong> – Lenguaje de Control de Datos<br>
<a href="https://es.wikipedia.org/wiki/Lenguaje_de_control_de_datos">https://es.wikipedia.org/wiki/Lenguaje_de_control_de_datos</a></li>
<li><strong>DDL – Data Definition Language</strong> – Lenguaje de Definición de Datos<br>
<a href="https://es.wikipedia.org/wiki/Lenguaje_de_definici%C3%B3n_de_datos">https://es.wikipedia.org/wiki/Lenguaje_de_definición_de_datos</a></li>
<li><strong>DML – Data Manipulation Language</strong> – Lenguaje de Manipulación de Datos<br>
<a href="https://es.wikipedia.org/wiki/Lenguaje_de_manipulaci%C3%B3n_de_datos">https://es.wikipedia.org/wiki/Lenguaje_de_manipulación_de_datos</a></li>
</ul>
<p>En las unidades anteriores hemos trabajado tanto el  DDL como el DML.</p>
<p>Las bases de datos relacionales poseen unas extensiones del lenguaje de consultas SQL que les permiten crear bloques de código que se ejecutan como un todo. Hay dos tipos de bloques de código:</p>
<ul>
<li><strong>Scripts</strong>: conjunto de instrucciones que se guardan en un fichero con extensión .sql y que no forman parte de la base de datos. Los scripts se utilizan principalmente para tareas de administración de la base de datos.</li>
<li><strong>Procedimientos y funciones almacenadas</strong>: bloques de código que forman parte de una base de datos concreta, como las tablas. Los procedimientos y funciones son compilados después de crealos y pasan a formar parte de la base de datos como otro objeto más. Hay unos procedimientos especiales llamados <strong>triggers</strong> que se ejecutan cuando sucede algún evento sobre las tablas de la base de datos.</li>
</ul>
<p>Todas las bases de datos relacionales permiten alamacenar código aunque la extemsión del lenguaje tiene una denominación diferente dependiendo del SGBD; en <strong>Oracle se llama PL/SQL</strong>, en <strong>SQL Server Transact-SQL</strong> y en <strong>MySQL Stored Procedure Programming</strong>.</p>
<p>En este tema nos centraremos en MySQL para trabajar con programación a través de <strong>procedimientos</strong>, <strong>funciones</strong> y <strong>tratamiento de eventos</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/stored-programs-views.html">MySQL Oficial – Almacenamiento de Programas en MySQL</a></p>
</div>
<p>Los procedimientos almacenados y funciones son nuevas funcionalidades incluidas desde la versión de MySQL 5.0.<br>
Algunas situaciones en que los procedimientos almacenados pueden ser particularmente útiles:</p>
<ul>
<li>Cuando múltiples aplicaciones cliente se escriben en <strong>distintos lenguajes</strong> o funcionan en distintas plataformas, pero necesitan <strong>realizar la misma operación en la base de datos</strong>.</li>
<li><strong>Cuando la seguridad es muy importante</strong>. Los bancos, por ejemplo, usan procedimientos almacenados para todas las operaciones comunes. Esto proporciona un entorno seguro y consistente, y los procedimientos pueden asegurar que cada operación se loguea apropiadamente. En tal entorno, las aplicaciones y los usuarios no obtendrían ningún acceso directo a las tablas de la base de datos, sólo pueden ejecutar algunos procedimientos almacenados.</li>
</ul>
<p>Los procedimientos almacenados pueden mejorar el rendimiento ya que se necesita enviar menos información entre el servidor y el cliente. El inconveniente es que aumenta la carga del servidor de la base de datos ya que la mayoría del trabajo se realiza en la parte del servidor y no en el cliente. Considere esto, si muchas máquinas cliente (como servidores Web) se sirven a sólo uno o pocos servidores de bases de datos.</p>
<p>Los procedimientos almacenados le permiten tener bibliotecas o funciones en el servidor de base de datos. Esta carácterística es compartida por los lenguajes de programación modernos que permiten este diseño interno, por ejemplo, usando clases. Usando estas carácterísticas del lenguaje de programación cliente es beneficioso para el programador incluso fuera del entorno de la base de datos.</p>
<h2 id="primeros-scripts">Primeros SCRIPTS </h2>
<h3 id="scripts-en-mysql">SCRIPTS en MySQL </h3>
<p>Comenzaremos por crear nuestro primer script en MySQL con sentencias de <strong>Stored Procedures</strong>.</p>
<p>Utilizaremos <strong><code>SELECT</code></strong> para mostrar resultados y <strong><code>SET</code></strong> para guardar valores en variables.</p>
<p>Los scripts de MySQL se puede ejecutar directamente con el programa  <strong><code>mysql.exe</code></strong>.</p>
<div class="caso_estudio">
<p><strong><code>mysql.exe</code></strong> es una shell que conecta con el servidor de MySQL y permite ejecutar instrucciones de SQL. Cuando nos conectamos tenemos que indicar y contraseña si procede.</p>
</div> <!-- fin caso de estudio -->
<p>Para conectarnos como root hacemos:<br>
<strong><code>C:\Program Files\MySQL\MySQL Server 8.0\bin&gt; mysql -u root -p</code></strong></p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Scripts</strong><br>
Crear un script de nombre <strong><code>b06ejer01.sql</code></strong> en una carpeta de nuestro gusto,por ejemplo <strong>C:\GBD-UD06</strong>. El script calcula la superficie de una pared a partir del ancho y alto de la misma. El ancho y alto se cargan previamente en dos variables.</p>
<p>El script lo creamos con un editor de texto y su contenido es el siguiente:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- En x tenemos el ancho de la pared</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
<span class="token comment">-- En y tenemos la altura</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@y</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
<span class="token comment">-- La instrucción select calcula y muestra la superficie de la pared conjuntamente con el ancho y la altura.</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@x</span> <span class="token keyword keyword-AS">AS</span> ancho<span class="token punctuation">,</span> <span class="token variable">@y</span> <span class="token keyword keyword-AS">AS</span> alto<span class="token punctuation">,</span> <span class="token variable">@x</span> <span class="token operator">*</span> <span class="token variable">@y</span> <span class="token keyword keyword-AS">AS</span> superficie<span class="token punctuation">;</span>
</code></pre><p>El script se puede ejecutar directamente con el programa  <strong><code>mysql.exe</code></strong>. Una vez que hayamos conectados utilizamos el comando <strong><code>source</code></strong> para ejecutar el script.</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>mysql&gt; source C:/GBD-UD6/b06ejer01.sql;
Query OK, 0 rows affected (0.00 sec)
Query OK, 0 rows affected (0.00 sec)
+-------+------+------------+
| ancho | alto | superficie |
+-------+------+------------+
| 9     | 15   | 135        |
+-------+------+------------+
1 row in set (0.00 sec)
</code></pre></div>
<p>Los nombres de las variables en los scripts tienen que comenzar con el símbolo <strong>@</strong>.<br>
Las instrucciones <strong><code>SET</code></strong> y <strong><code>SELECT</code></strong> pueden ejecutarse también directamente desde el intérprete de comandos.</p>
<h3 id="comentarios">Comentarios </h3>
<p>Los comentarios dentro de los SCRIPTS pueden hacerse de la siguiente manera:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment"># comentario con almohadilla (solo una linea)</span>
<span class="token comment">-- Comentario con dos guiones (solo una linea)</span>
<span class="token comment">/* comentario con barra asterisco (solo una linea) */</span>
<span class="token comment">/*
  esto es
  un comentario
  multilinea
*/</span>
</code></pre><h3 id="variables-definidas-por-el-usuario">Variables definidas por el usuario </h3>
<p>Para definir una variable de usuario utilizaremos el carácter <strong>@</strong>. Asignaremos valores con el comando <strong><code>SET</code></strong>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token variable">@cad</span> <span class="token operator">=</span> <span class="token string">'Hola'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> :<span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token variable">@cad</span> :<span class="token operator">=</span> <span class="token string">'Hola'</span><span class="token punctuation">;</span>
</code></pre><p>Y para mostrar sus valores la instrucción <strong><code>SELECT</code></strong>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">,</span> <span class="token variable">@cad</span><span class="token punctuation">;</span>
</code></pre><p>Las variables puede usarse en instrucciones <strong><code>SELECT</code></strong> de recuperación de datos, como:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> ciudades <span class="token keyword keyword-WHERE">WHERE</span> codigo <span class="token operator">&gt;</span> <span class="token variable">@num</span><span class="token punctuation">;</span>
</code></pre><p>También podemos calcular y asignar valor en la misma instrucción, almacenando resultados de nuestras <strong><code>SELECT</code></strong>, pero en este caso sólo funciona el operador <strong><code>:=</code></strong>. Si no deseamos que se produzca la salida del resultado, sino sólo almacenarlo, podemos usar la cláusula <strong><code>INTO</code></strong>:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Scripts</strong><br>
Crear un script que asigne a la variable <strong>numreg</strong> la cantidad de ciudades que hay en la tabla <strong>ciudades</strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Asigna el número de ciudades a la variable numreg y muestra el resultado por pantalla.</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@numreg</span> :<span class="token operator">=</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> ciudades<span class="token punctuation">;</span>

<span class="token comment">-- Asigna el número de ciudades a la variable numreg pero NO  muestra el resultado por pantalla.</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-INTO">INTO</span> <span class="token variable">@numreg</span> <span class="token keyword keyword-FROM">FROM</span> ciudades<span class="token punctuation">;</span>
</code></pre></div>
<p>Para consultar todas las variables creadas por el usuario, podemos consultar la tabla <strong>performance_schema.user_variables_by_thread</strong> a partir de la versión 5.7 de MySQL:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> performance_schema<span class="token punctuation">.</span>user_variables_by_thread<span class="token punctuation">;</span>
</code></pre><h3 id="variables-del-sistema">Variables del sistema </h3>
<p>MySQL tiene muchas variables de sistema que pueden consultarse en <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variable-reference.html">https://dev.mysql.com/doc/refman/8.0/en/server-system-variable-reference.html</a> y que podemos consultar con la instrucción <strong><code>SHOW VARIABLES LIKE</code></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SHOW">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%'</span><span class="token punctuation">;</span>
</code></pre><p>Las variables de sistema pueden ser de tipo:</p>
<ul>
<li><strong>GLOBAL</strong>: su valor es para todos los usuarios conectados</li>
<li><strong>SESSION</strong>: su valor puede ser diferente para cada usuario</li>
</ul>
<p>Para mostrar el valor de alguna variable global utilizaremos una doble <strong>@</strong> tal como se muestra en este ejemplo con la variable <em>max_connections</em>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> @<span class="token variable">@max_connections</span><span class="token punctuation">;</span>
</code></pre><p>Para asignar un nuevo valor a la variable <strong>GLOBAL</strong> utilizaremos una de las dos opciones siguientes:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SET">SET</span> <span class="token keyword keyword-GLOBAL">GLOBAL</span> max_connections <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> @<span class="token variable">@global.max_connections</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
</code></pre><p>Por ejemplo la variable <em>lc_messages</em> define el idioma en que se muestran los mensajes de error. Podríamos tener el valor <em>en_US</em> para tenerlos en inglés o <em>es_ES</em> para español.</p>
<p>Para asignar un nuevo valor a la variable de sistema de tipo <strong>SESSION</strong> utilizaremos una de las siguientes cuatro opciones mostradas en el ejemplo con la variable <em>lc_messages</em>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SET">SET</span> lc_messages <span class="token operator">=</span> <span class="token string">'es_ES'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> @<span class="token variable">@lc_messages</span><span class="token operator">=</span><span class="token string">'es_ES'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token keyword keyword-SESSION">SESSION</span> lc_messages <span class="token operator">=</span> <span class="token string">'es_ES'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> @<span class="token variable">@local.lc_messages</span><span class="token operator">=</span><span class="token string">'es_ES'</span><span class="token punctuation">;</span>
</code></pre><p>Prueba a ejecutar las siguientes instrucciones después de conectar con <strong><code>mysql.exe</code></strong> y comprueba el resultado:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword keyword-SET">SET</span> <span class="token keyword keyword-SESSION">SESSION</span> lc_messages<span class="token operator">=</span><span class="token string">'en_US'</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> MENSAJES<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token operator">in</span> your <span class="token keyword keyword-SQL">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword keyword-check">check</span>
the manual that corresponds <span class="token keyword keyword-to">to</span> your MySQL server version <span class="token keyword keyword-for">for</span> the
<span class="token keyword keyword-right">right</span> syntax <span class="token keyword keyword-to">to</span> <span class="token keyword keyword-use">use</span> near <span class="token string">'MENSAJES'</span> at line <span class="token number">1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword keyword-SET">SET</span> <span class="token keyword keyword-SESSION">SESSION</span> lc_messages<span class="token operator">=</span><span class="token string">'es_ES'</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> MENSAJES<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Algo está equivocado en su sintax cerca
<span class="token string">'MENSAJES'</span> en la linea <span class="token number">1</span>
</code></pre><div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Scripts</strong><br>
Crea un <strong>script</strong> que conecte con la base de datos <strong>world</strong> y guarde en una variable el número de registros de la tabla <strong>city</strong> y en otra el número de registros de la tabla <strong>country</strong>. Ejecutar un <strong><code>SELECT</code></strong> que muestre la cantidad de registros de las dos tablas.</p>
<p>El script <strong><code>b06ejer02.sql</code></strong> tendrá las siguiente instrucciones:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-USE">USE</span> world<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@numCity</span> :<span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> city<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@numCountry</span> :<span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> country<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@numCity</span> <span class="token keyword keyword-AS">AS</span> NREG_City<span class="token punctuation">,</span> <span class="token variable">@numCountry</span> <span class="token keyword keyword-AS">AS</span> NREG_Country<span class="token punctuation">;</span>
</code></pre><p>Para ejecutar el script realizamos los siguientes comandos:</p>
<pre data-role="codeBlock" data-info="cmd" class="language-cmd cmd"><code>C:\&gt; cd "\Program Files\MySQL\MySQL Server 8.0\bin\mysql"
C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql&gt; mysql -u root -p
mysql&gt; source C:/GBD-UD6/b06ejer02.sql;
</code></pre></div>
<h4 id="ejecutar-scripts">Ejecutar scripts </h4>
<p>La mayoría de scripts los generamos en UTF8 por lo que deberemos cambiar el conjunto de carácteres de la ventana de comandos del CMD.</p>
<pre data-role="codeBlock" data-info="cmd" class="language-cmd cmd"><code>// Cambiar a juego de carácteres en UTF8
C:\&gt; chcp 65001
// Cambiar a juego de carácteres en ANSI West European Latin
C:\&gt; chcp 1252
</code></pre><p>Para cambiar en timepo real el juego de carácteres en el resultado de los <strong><code>SELECT</code></strong> en MySQL, podemos utilizar el comando <strong><strong><code>SET NAMES</code></strong></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">// Cambiar a juego de carácteres en UTF8</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword keyword-SET">SET</span> NAMES <span class="token string">'utf8'</span><span class="token punctuation">;</span>
<span class="token comment">// Cambiar a juego de carácteres en ANSI West European Latin</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword keyword-SET">SET</span> NAMES <span class="token string">'latin1'</span><span class="token punctuation">;</span>
</code></pre><p>El comando <strong><code>mysql</code></strong> dispone además de muchos parámetros. Usaremos algunos:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Parámetro</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>--silent</strong></td>
<td style="text-align:left">En el modo silencioso no muestra tantos mensajes</td>
</tr>
<tr>
<td style="text-align:left"><strong>--table</strong></td>
<td style="text-align:left">La salida de los SELECT la muestra en formato tabla</td>
</tr>
<tr>
<td style="text-align:left"><strong>--html</strong></td>
<td style="text-align:left">La salida de los SELECT la muestra en formato HTML</td>
</tr>
</tbody>
</table>
<p>Ejemplo de forma de conexión.</p>
<pre data-role="codeBlock" data-info="cmd" class="language-cmd cmd"><code>//Conectarse como root en modo silencioso
C:\&gt; mysql -u root -p --silent --table
</code></pre><h2 id="procedimientos-y-estructuras-de-control">Procedimientos y estructuras de control </h2>
<h3 id="sintaxis-y-estructura">Sintaxis y Estructura </h3>
<p>Para poder almacenar un conjunto de instrucciones en la propia base de datos podemos utilizar los procedimientos.</p>
<p>La sintaxis más sencilla es la siguiente:</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> nombre<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    instrucciones<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p>Antes de comenzar debemos seleccionar la base de datos con la que vamos a trabajar. Por ejemplo para trabajar con la base de datos world ejecutaríamos:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-USE">USE</span> world<span class="token punctuation">;</span>
</code></pre><p>Si por ejemplo deseamos un procedimiento que muestre el día y hora sería:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Procedimientos</strong><br>
Realizar un procedimiento que calcule el día y la hora actual y la muestre por pantalla.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> diayhora<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div>
<p>Para llamar al procedimiento se utiliza el comando <strong><code>CALL</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Procedimientos</strong><br>
Ejecutar el procedimiento <strong>diayhora</strong> creado en el ejemplo anterior.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CALL">CALL</span> diayhora<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Los procedimientos se asignan a una base de datos. Esto quiere decir que debemos indicar el <strong>SCHEMA</strong> o BASE DE DATOS al crear o eliminar el procedimiento. Podemos usar previamente la selección de base de datos por defecto con el comando <strong><code>USE</code></strong> como en el ejemplo anterior o bien indicarla al crear el procedimiento como se hace en los <strong><code>SELECT</code></strong> de las tablas. Por ejemplo para crear el procedimiento en la base de datos world, independientemente de cual tengamos seleccionada, la cabecera del procedimiento sería: <strong><code>CREATE PROCEDURE world.diayhora()</code></strong>.</p>
<h4 id="delimiter">DELIMITER </h4>
<p>En la declaración del procedimiento hemos usado delimiter pero, ¿por qué es importante el uso del <strong><code>DELIMITER</code></strong>?.</p>
<p>Ya sabemos que por defecto MySQL usa como delimitador de fin de instrucción el punto y coma (;) , es decir, cada vez que encuentre punto y como(;) ejecuta hasta ahí. Como en los procedimientos hay varias líneas de códigos y algunas de ellas terminan con este delimitador se ejecutaría solo hasta ahí, lo que ocasionaría un error, y es por esto que es necesario indicarle a MySQL que utilice otro dlimitador que puede ser cualquiera. Ese es el próposito de la cláusula <strong><code>DELIMITER</code></strong>.</p>
<p>Para nuestro ejemplo usamos <strong>//</strong> pero se podría usar también <strong>$$</strong> o lo que queramos. Al finalizar la creación del procedimiento o función volvemos a cambiarlo por <strong>;</strong></p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DELIMITER">DELIMITER</span> $$
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    $$
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<h4 id="bloques-de-código">Bloques de código </h4>
<p>Para poder agrupar varias instrucciones en bloques utilizaremos: <strong><code>BEGIN ... END</code></strong>.<br>
En los procedimientos es necesario porque define el espacio de instrucciones que se almacenan.</p>
<p>Estos bloques de código se usarán más adelante también en estructuras de control como: <strong><code>IF .. THEN .. END IF</code></strong></p>
<h4 id="redefinir-y-eliminar">Redefinir y Eliminar </h4>
<p>Para eliminar un procedimiento utilizaremos la instrucción <strong><code>DROP PROCEDURE</code></strong>.</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> nombreProcedimiento<span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p>Si queremos redefinir un procedimiento, para evitar que si no existe muestre un error lo haremos utilizando la cláusula <strong><code>IF EXISTS</code></strong>.</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> nombreProcedimiento<span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<h3 id="variables-locales-del-procedimiento">Variables locales del procedimiento </h3>
<p>Cuando necesitamos variables que usaremos dentro del procedimiento debemos usar la instrucción <strong><code>DECLARE</code></strong> como si lo hiciéramos en la instrucción <strong><code>CREATE TABLE</code></strong>. Las variables sólo serán visibles y accesibles dentro del procedimiento.<br>
Estas variables no comienzan con el carácter especial @, al contrario de lo que sucede en los scripts.</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DECLARE">DECLARE</span> nombreVariable tipoVariable <span class="token punctuation">[</span>opciones<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<h3 id="estructuras-de-control">Estructuras de control </h3>
<p>Las instrucciones de un procedimiento (o función) se ejecutan secuencialmente empezando por la instrucción que está justo después de la palabra reservada <strong><code>BEGIN</code></strong> y acabando por la que está justo antes de la palabra reservada <strong><code>END</code></strong>. Esta forma de ejcución de instrucciones se llama <strong>secuencial</strong>. El siguiente diagrama representa un bloque de 3 instrucciones que se ejecutan secuencialmente. El punto negro inicial representa el <strong><code>BEGIN</code></strong> y el punto con el aspa el <strong><code>END</code></strong>.</p>
<p align="center" style="zoom:1" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="ACTIVITY" height="250px" preserveAspectRatio="none" style="width:115px;height:250px;background:#FFFFFF;" version="1.1" viewBox="0 0 115 250" width="115px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="57.6063" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"></ellipse><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="93.2125" x="11" y="50"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73.2125" x="21" y="72.8281">Instrucción 1</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="93.2125" x="11" y="106.3441"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73.2125" x="21" y="129.1722">Instrucción 2</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="93.2125" x="11" y="162.6882"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73.2125" x="21" y="185.5163">Instrucción 3</text><ellipse cx="57.6063" cy="229.0323" fill="none" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;"></ellipse><line style="stroke:#222222;stroke-width:2.5;" x1="51.4191" x2="63.7934" y1="222.8452" y2="235.2195"></line><line style="stroke:#222222;stroke-width:2.5;" x1="63.7934" x2="51.4191" y1="222.8452" y2="235.2195"></line><line style="stroke:#181818;stroke-width:1;" x1="57.6063" x2="57.6063" y1="30" y2="50"></line><polygon fill="#181818" points="53.6063,40,57.6063,50,61.6063,40,57.6063,44" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="57.6063" x2="57.6063" y1="86.3441" y2="106.3441"></line><polygon fill="#181818" points="53.6063,96.3441,57.6063,106.3441,61.6063,96.3441,57.6063,100.3441" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="57.6063" x2="57.6063" y1="142.6882" y2="162.6882"></line><polygon fill="#181818" points="53.6063,152.6882,57.6063,162.6882,61.6063,152.6882,57.6063,156.6882" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="57.6063" x2="57.6063" y1="199.0323" y2="219.0323"></line><polygon fill="#181818" points="53.6063,209.0323,57.6063,219.0323,61.6063,209.0323,57.6063,213.0323" style="stroke:#181818;stroke-width:1;"></polygon><!--SRC=[Kr1GA2v9B2hXKb1GiFBCAoufAarEpZoyEK_1q1fJp0YBc35OB3Kl1G00]--></g></svg></p><p>Las estructuras de control permiten modificar el flujo de ejecución de las instrucciones de un programa.</p>
<p>No obstante, hay algunas directiva que nos permiten cambiar el orden secuencial de ejecución de instrucciones. A estas directivas comunmente se les llama estructuras de control. Las estructuras de control se pueden englobar en dos categorías:</p>
<ul>
<li><strong>Estructuras de control condicionales</strong>: en función de una condición se ejecutan un bloque de instrucciones u otro (o ninguno).</li>
<li><strong>Estructuras de control de repetición</strong>: permiten que un bloque de instrucciones se ejecuta un cierto o número de veces o mientras se cumpla una condición.</li>
</ul>
<h4 id="estructuras-de-control-condicionales">Estructuras de control condicionales </h4>
<p><strong>Sentencia IF</strong><br>
Es la más sencilla de todas. Nos permite ejecutar unas instrucciones u otras según una condición. Hay 3 variantes:</p>
<p><em><strong>Variante 1</strong></em><br>
Esquema general</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-IF">IF</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p align="center" style="zoom:1" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="ACTIVITY" height="302px" preserveAspectRatio="none" style="width:689px;height:302px;background:#FFFFFF;" version="1.1" viewBox="0 0 689 302" width="689px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="322.2736" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"></ellipse><path d="M10,99.4909 L10,144.903 A0,0 0 0 0 10,144.903 L236.1792,144.903 A0,0 0 0 0 236.1792,144.903 L236.1792,126.197 L256.1792,122.197 L236.1792,118.197 L236.1792,109.4909 L226.1792,99.4909 L10,99.4909 A0,0 0 0 0 10,99.4909" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M226.1792,99.4909 L226.1792,109.4909 L236.1792,109.4909 L226.1792,99.4909" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9182" x="16" y="118.388">Este bloque de sentencias sólo se</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.278" x="16" y="136.094">ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12.22" x="63.658" y="136.094">SI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9211" x="79.2581" y="136.094">se cumple la condición.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.1888" x="256.1792" y="104.0249"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="266.1792" y="126.853">bloque sentencias 1</text><polygon fill="#F1F1F1" points="297.3203,50,347.2269,50,359.2269,62,347.2269,74,297.3203,74,285.3203,62,297.3203,50" style="stroke:#181818;stroke-width:0.5;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="9.4159" x="326.2736" y="85.7589">Sí</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49.9066" x="297.3203" y="66.268">condición</text><polygon fill="#F1F1F1" points="322.2736,164.903,334.2736,176.903,322.2736,188.903,310.2736,176.903,322.2736,164.903" style="stroke:#181818;stroke-width:0.5;"></polygon><path d="M424.4721,204.369 L424.4721,223.075 L404.4721,227.075 L424.4721,231.075 L424.4721,249.7811 A0,0 0 0 0 424.4721,249.7811 L677.4313,249.7811 A0,0 0 0 0 677.4313,249.7811 L677.4313,214.369 L667.4313,204.369 L424.4721,204.369 A0,0 0 0 0 424.4721,204.369" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M667.4313,204.369 L667.4313,214.369 L677.4313,214.369 L667.4313,204.369" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.8852" x="430.4721" y="223.266">Este bloque de sentencias se ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.689" x="430.4721" y="240.972">siempre</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.2702" x="483.1611" y="240.972">, se cumpla o no la condición.</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164.397" x="240.0751" y="208.903"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.397" x="250.0751" y="231.7311">bloque sentencias común</text><ellipse cx="322.2736" cy="280.7811" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"></ellipse><ellipse cx="322.2736" cy="280.7811" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"></ellipse><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="74" y2="104.0249"></line><polygon fill="#181818" points="318.2736,94.0249,322.2736,104.0249,326.2736,94.0249,322.2736,98.0249" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="359.2269" x2="398.368" y1="62" y2="62"></line><polygon fill="#181818" points="394.368,112.197,398.368,122.197,402.368,112.197,398.368,116.197" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="398.368" x2="398.368" y1="62" y2="176.903"></line><line style="stroke:#181818;stroke-width:1;" x1="398.368" x2="334.2736" y1="176.903" y2="176.903"></line><polygon fill="#181818" points="344.2736,172.903,334.2736,176.903,344.2736,180.903,340.2736,176.903" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="140.369" y2="164.903"></line><polygon fill="#181818" points="318.2736,154.903,322.2736,164.903,326.2736,154.903,322.2736,158.903" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="30" y2="50"></line><polygon fill="#181818" points="318.2736,40,322.2736,50,326.2736,40,322.2736,44" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="188.903" y2="208.903"></line><polygon fill="#181818" points="318.2736,198.903,322.2736,208.903,326.2736,198.903,322.2736,202.903" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="245.2471" y2="269.7811"></line><polygon fill="#181818" points="318.2736,259.7811,322.2736,269.7811,326.2736,259.7811,322.2736,263.7811" style="stroke:#181818;stroke-width:1;"></polygon><!--SRC=[VSun3i8m30NGtQUmnD9Q28aLPWPcJX1IjmrAdTAunsBgnfgB4Q028G6RzMtzvwXcK70r5ZP8vQnBavIeBGiMH8Tq8IfXuLtJQZCmo-RemtbaZ2pAOfs9kDw216NOHMMSrzN7HKoJ3pa0Fh4TrM1ktXFb1EtOzPxH6tpxAs2fyD6P1rV35zI6BbtbAUDmV- -VppZBG1GTT_t0HCkNRp1axkSJKKD_0m00]--></g></svg></p><p>El rombo equivaldría al <strong><code>END IF</code></strong>.</p>
<p><em><strong>Variante 2</strong></em><br>
Esquema general</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-IF">IF</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-ELSE">ELSE</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p align="center" style="zoom:1" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="ACTIVITY" height="273px" preserveAspectRatio="none" style="width:820px;height:273px;background:#FFFFFF;" version="1.1" viewBox="0 0 820 273" width="820px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="398.368" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"></ellipse><polygon fill="#F1F1F1" points="373.4147,50,423.3213,50,435.3213,62,423.3213,74,373.4147,74,361.4147,62,373.4147,50" style="stroke:#181818;stroke-width:0.5;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49.9066" x="373.4147" y="66.268">condición</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="9.4159" x="351.9987" y="58.777">Sí</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="15.7519" x="435.3213" y="58.777">No</text><path d="M10,84 L10,129.412 A0,0 0 0 0 10,129.412 L236.1792,129.412 A0,0 0 0 0 236.1792,129.412 L236.1792,110.706 L256.1792,106.706 L236.1792,102.706 L236.1792,94 L226.1792,84 L10,84 A0,0 0 0 0 10,84" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M226.1792,84 L226.1792,94 L236.1792,94 L226.1792,84" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9182" x="16" y="102.897">Este bloque de sentencias sólo se</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.278" x="16" y="120.603">ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12.22" x="63.658" y="120.603">SI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9211" x="79.2581" y="120.603">se cumple la condición.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.1888" x="256.1792" y="88.534"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="266.1792" y="111.362">bloque sentencias 1</text><path d="M560.5568,84 L560.5568,102.706 L540.5568,106.706 L560.5568,110.706 L560.5568,129.412 A0,0 0 0 0 560.5568,129.412 L808.394,129.412 A0,0 0 0 0 808.394,129.412 L808.394,94 L798.394,84 L560.5568,84 A0,0 0 0 0 560.5568,84" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M798.394,84 L798.394,94 L808.394,94 L798.394,84" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9182" x="566.5568" y="102.897">Este bloque de sentencias sólo se</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57.239" x="566.5568" y="120.603">ejecuta si</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.917" x="627.1758" y="120.603">NO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9211" x="651.4729" y="120.603">se cumple la condición.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.1888" x="408.368" y="88.534"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="418.368" y="111.362">bloque sentencias 2</text><polygon fill="#F1F1F1" points="398.368,135.412,410.368,147.412,398.368,159.412,386.368,147.412,398.368,135.412" style="stroke:#181818;stroke-width:0.5;"></polygon><path d="M43.2103,174.8781 L43.2103,220.2901 A0,0 0 0 0 43.2103,220.2901 L296.1695,220.2901 A0,0 0 0 0 296.1695,220.2901 L296.1695,201.5841 L316.1695,197.5841 L296.1695,193.5841 L296.1695,184.8781 L286.1695,174.8781 L43.2103,174.8781 A0,0 0 0 0 43.2103,174.8781" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M286.1695,174.8781 L286.1695,184.8781 L296.1695,184.8781 L286.1695,174.8781" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.8852" x="49.2103" y="193.7751">Este bloque de sentencias se ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.689" x="49.2103" y="211.4811">siempre</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.2702" x="101.8993" y="211.4811">, se cumpla o no la condición.</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164.397" x="316.1695" y="179.412"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.397" x="326.1695" y="202.2401">bloque sentencias común</text><ellipse cx="398.368" cy="251.2901" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"></ellipse><ellipse cx="398.368" cy="251.2901" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"></ellipse><line style="stroke:#181818;stroke-width:1;" x1="361.4147" x2="322.2736" y1="62" y2="62"></line><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="62" y2="88.534"></line><polygon fill="#181818" points="318.2736,78.534,322.2736,88.534,326.2736,78.534,322.2736,82.534" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="435.3213" x2="474.4624" y1="62" y2="62"></line><line style="stroke:#181818;stroke-width:1;" x1="474.4624" x2="474.4624" y1="62" y2="88.534"></line><polygon fill="#181818" points="470.4624,78.534,474.4624,88.534,478.4624,78.534,474.4624,82.534" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="322.2736" y1="124.8781" y2="147.412"></line><line style="stroke:#181818;stroke-width:1;" x1="322.2736" x2="386.368" y1="147.412" y2="147.412"></line><polygon fill="#181818" points="376.368,143.412,386.368,147.412,376.368,151.412,380.368,147.412" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="474.4624" x2="474.4624" y1="124.8781" y2="147.412"></line><line style="stroke:#181818;stroke-width:1;" x1="474.4624" x2="410.368" y1="147.412" y2="147.412"></line><polygon fill="#181818" points="420.368,143.412,410.368,147.412,420.368,151.412,416.368,147.412" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="398.368" x2="398.368" y1="30" y2="50"></line><polygon fill="#181818" points="394.368,40,398.368,50,402.368,40,398.368,44" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="398.368" x2="398.368" y1="159.412" y2="179.412"></line><polygon fill="#181818" points="394.368,169.412,398.368,179.412,402.368,169.412,398.368,173.412" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="398.368" x2="398.368" y1="215.7561" y2="240.2901"></line><polygon fill="#181818" points="394.368,230.2901,398.368,240.2901,402.368,230.2901,398.368,234.2901" style="stroke:#181818;stroke-width:1;"></polygon><!--SRC=[bP0n3i8m34NtdC8IIsiX91XXPc21WHE4r6s3KgSqxh6Okh7sOWIeG4YWmcPzV_azEOXkHDaS4kCviyRs7QSW9J4aYFl-Z9YgYRD5AKL3nCk3ywUM810BiR4wm7obs0kfTH22OPszDKBVEHy3HKSohMY8bpU8CG7JLhKZS1fU_9aYpk1-arpiH96j7_TOF3oWkPN-iGas2crtlmd5mURg0zxugh_m-2y81gv239QgkY74wHEjmKVILtuGNry1]--></g></svg></p><p><em><strong>Variante 3</strong></em><br>
Esquema general</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-IF">IF</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-ELSEIF">ELSEIF</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-ELSE">ELSE</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p align="center" style="zoom:1" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="ACTIVITY" height="432px" preserveAspectRatio="none" style="width:691px;height:432px;background:#FFFFFF;" version="1.1" viewBox="0 0 691 432" width="691px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="386.7508" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"></ellipse><path d="M400.9788,74 L400.9788,92.706 L380.9788,96.706 L400.9788,100.706 L400.9788,119.412 A0,0 0 0 0 400.9788,119.412 L627.379,119.412 A0,0 0 0 0 627.379,119.412 L627.379,84 L617.379,74 L400.9788,74 A0,0 0 0 0 400.9788,74" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M617.379,74 L617.379,84 L627.379,84 L617.379,74" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.8002" x="406.9788" y="92.897">Las sentencias sólo se ejecutan</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12.22" x="600.159" y="92.897">SI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.6082" x="406.9788" y="110.603">se cumple la condición A.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="135.3088" x="245.67" y="78.534"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="258.79" y="101.362">bloque sentencias 1</text><path d="M375.3363,163.412 L375.3363,182.118 L355.3363,186.118 L375.3363,190.118 L375.3363,208.8241 A0,0 0 0 0 375.3363,208.8241 L649.9015,208.8241 A0,0 0 0 0 649.9015,208.8241 L649.9015,173.412 L639.9015,163.412 L375.3363,163.412 A0,0 0 0 0 375.3363,163.412" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M639.9015,163.412 L639.9015,173.412 L649.9015,173.412 L639.9015,163.412" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7612" x="381.3363" y="182.309">Las sentencias sólo se ejecutan si</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.917" x="587.4774" y="182.309">NO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.559" x="611.7745" y="182.309">se</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.1951" x="381.3363" y="200.0151">cumple la condición A y</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12.22" x="527.9114" y="200.0151">SÍ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.3901" x="543.5114" y="200.0151">se cumple la B.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.1888" x="223.1475" y="167.946"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="233.1475" y="190.7741">bloque sentencias 2</text><polygon fill="#F1F1F1" points="98.4091,50,158.2047,50,170.2047,62,158.2047,74,98.4091,74,86.4091,62,98.4091,50" style="stroke:#181818;stroke-width:0.5;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59.7956" x="98.4091" y="66.268">condición A</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="9.4159" x="170.2047" y="58.777">Sí</text><polygon fill="#F1F1F1" points="99.0031,139.412,157.6107,139.412,169.6107,151.412,157.6107,163.412,99.0031,163.412,87.0031,151.412,99.0031,139.412" style="stroke:#181818;stroke-width:0.5;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="58.6076" x="99.0031" y="155.68">condition B</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="9.4159" x="169.6107" y="148.1891">Sí</text><path d="M337.1261,228.8241 L337.1261,247.5301 L317.1261,251.5301 L337.1261,255.5301 L337.1261,274.2361 A0,0 0 0 0 337.1261,274.2361 L588.5643,274.2361 A0,0 0 0 0 588.5643,274.2361 L588.5643,238.8241 L578.5643,228.8241 L337.1261,228.8241 A0,0 0 0 0 337.1261,228.8241" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M578.5643,228.8241 L578.5643,238.8241 L588.5643,238.8241 L578.5643,228.8241" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7612" x="343.1261" y="247.7211">Las sentencias sólo se ejecutan si</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.917" x="549.2672" y="247.7211">NO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3.38" x="570.1842" y="247.7211">&nbsp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.0522" x="343.1261" y="265.4271">se cumple ninguna condición.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="132.1888" x="184.9373" y="233.358"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112.1888" x="194.9373" y="256.1861">bloque sentencias 3</text><polygon fill="#F1F1F1" points="386.7508,294.2361,398.7508,306.2361,386.7508,318.2361,374.7508,306.2361,386.7508,294.2361" style="stroke:#181818;stroke-width:0.5;"></polygon><path d="M10,333.7021 L10,379.1142 A0,0 0 0 0 10,379.1142 L284.5522,379.1142 A0,0 0 0 0 284.5522,379.1142 L284.5522,360.4082 L304.5522,356.4082 L284.5522,352.4082 L284.5522,343.7021 L274.5522,333.7021 L10,333.7021 A0,0 0 0 0 10,333.7021" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M274.5522,333.7021 L274.5522,343.7021 L284.5522,343.7021 L274.5522,333.7021" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.8852" x="16" y="352.5992">Este bloque de sentencias se ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.689" x="16" y="370.3052">siempre</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.8632" x="68.689" y="370.3052">, se cumplan o no la condiciones.</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164.397" x="304.5522" y="338.2361"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.397" x="314.5522" y="361.0642">bloque sentencias común</text><ellipse cx="386.7508" cy="410.1142" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"></ellipse><ellipse cx="386.7508" cy="410.1142" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"></ellipse><line style="stroke:#181818;stroke-width:1;" x1="170.2047" x2="313.3244" y1="62" y2="62"></line><line style="stroke:#181818;stroke-width:1;" x1="313.3244" x2="313.3244" y1="62" y2="78.534"></line><polygon fill="#181818" points="309.3244,68.534,313.3244,78.534,317.3244,68.534,313.3244,72.534" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="169.6107" x2="289.2419" y1="151.412" y2="151.412"></line><line style="stroke:#181818;stroke-width:1;" x1="289.2419" x2="289.2419" y1="151.412" y2="167.946"></line><polygon fill="#181818" points="285.2419,157.946,289.2419,167.946,293.2419,157.946,289.2419,161.946" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="128.3069" x2="128.3069" y1="74" y2="139.412"></line><polygon fill="#181818" points="124.3069,129.412,128.3069,139.412,132.3069,129.412,128.3069,133.412" style="stroke:#181818;stroke-width:1;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="15.7519" x="128.3069" y="105.974">No</text><line style="stroke:#181818;stroke-width:1;" x1="313.3244" x2="313.3244" y1="114.8781" y2="129.8781"></line><line style="stroke:#181818;stroke-width:1;" x1="313.3244" x2="669.9015" y1="129.8781" y2="129.8781"></line><line style="stroke:#181818;stroke-width:1;" x1="669.9015" x2="669.9015" y1="129.8781" y2="306.2361"></line><line style="stroke:#181818;stroke-width:1;" x1="669.9015" x2="398.7508" y1="306.2361" y2="306.2361"></line><polygon fill="#181818" points="408.7508,302.2361,398.7508,306.2361,408.7508,310.2361,404.7508,306.2361" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="289.2419" x2="289.2419" y1="204.2901" y2="219.2901"></line><line style="stroke:#181818;stroke-width:1;" x1="289.2419" x2="669.9015" y1="219.2901" y2="219.2901"></line><polygon fill="#181818" points="659.9015,215.2901,669.9015,219.2901,659.9015,223.2901,663.9015,219.2901" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="386.7508" x2="386.7508" y1="30" y2="35"></line><line style="stroke:#181818;stroke-width:1;" x1="386.7508" x2="128.3069" y1="35" y2="35"></line><line style="stroke:#181818;stroke-width:1;" x1="128.3069" x2="128.3069" y1="35" y2="50"></line><polygon fill="#181818" points="124.3069,40,128.3069,50,132.3069,40,128.3069,44" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="128.3069" x2="128.3069" y1="163.412" y2="218.358"></line><line style="stroke:#181818;stroke-width:1;" x1="128.3069" x2="251.0317" y1="218.358" y2="218.358"></line><line style="stroke:#181818;stroke-width:1;" x1="251.0317" x2="251.0317" y1="218.358" y2="233.358"></line><polygon fill="#181818" points="247.0317,223.358,251.0317,233.358,255.0317,223.358,251.0317,227.358" style="stroke:#181818;stroke-width:1;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="15.7519" x="128.3069" y="197.653">No</text><line style="stroke:#181818;stroke-width:1;" x1="251.0317" x2="251.0317" y1="269.7021" y2="279.2361"></line><line style="stroke:#181818;stroke-width:1;" x1="251.0317" x2="386.7508" y1="279.2361" y2="279.2361"></line><line style="stroke:#181818;stroke-width:1;" x1="386.7508" x2="386.7508" y1="279.2361" y2="294.2361"></line><polygon fill="#181818" points="382.7508,284.2361,386.7508,294.2361,390.7508,284.2361,386.7508,288.2361" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="386.7508" x2="386.7508" y1="318.2361" y2="338.2361"></line><polygon fill="#181818" points="382.7508,328.2361,386.7508,338.2361,390.7508,328.2361,386.7508,332.2361" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="386.7508" x2="386.7508" y1="374.5802" y2="399.1142"></line><polygon fill="#181818" points="382.7508,389.1142,386.7508,399.1142,390.7508,389.1142,386.7508,393.1142" style="stroke:#181818;stroke-width:1;"></polygon><!--SRC=[dT0xJWCn40RWVaunY2OP8IIWWuf8595GA93eZNTsO-GTBtuK78AZKAMZtOinooCO4O6WiyOZ_z_llI6QhZTO4jzmpCuQlsmn2AHiOWRNuim6QPnruqRmV8vvpO8peklnYMWE-zvrwzn5PZd5Mn_k2sDYoIpMcOH7Po0XCyPf2ovrKbscSUE33f3ls9Pi1FNP9H7eo9P-y8pUO1r_22mDJY-24bP11SW-yPQPNH1S_AZyZZp-6p8vTQwkY7GAkvtuC5KP7rztgYwBgi3aneyMlmXF_YkilbAST4LgPutHWsjXHxGD_VWiR_bmaHJnljDyMVkC1wBak1yY4nriwwigQ5JrKK4uLOAKm_02]--></g></svg></p><p>Puede haber tantas cláusulas <strong><code>ELSEIF</code></strong> como queramos pero sólo puede haber una cláusula <strong><code>IF</code></strong> y una <strong><code>ELSE</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Procedimientos <code>IF</code></strong><br>
En el siguiente ejemplo creamos un procedimiento para mostrar un <strong>color</strong> de forma aleatoria según el valor obtenido con la función <strong><code>RAND()</code></strong> la cual devuelve un número real entre 0 y 1, es decir, obtenemos un número n que cumple 0 ≤ n &lt; 1.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Eliminar el procedimiento si ya existe</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> colores<span class="token punctuation">;</span>

<span class="token comment">-- Crear el procedimiento</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> colores<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> num <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> num :<span class="token operator">=</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-IF">IF</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'verde'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
    <span class="token keyword keyword-ELSEIF">ELSEIF</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.50</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'amarillo'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
    <span class="token keyword keyword-ELSEIF">ELSEIF</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'naranja'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
    <span class="token keyword keyword-ELSE">ELSE</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'rojo'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>

<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">-- Llamar al procedimiento</span>
<span class="token keyword keyword-CALL">CALL</span> colores<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><strong>Sentencia CASE</strong><br>
Cuando tenemos varias opciones como en el ejemplo anterior, podemos utilizar también la estructura <strong><code>CASE</code></strong>.</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CASE">CASE</span> <span class="token punctuation">[</span>variable o expresión<span class="token punctuation">]</span>
    <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">[</span>valor<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">[</span>valor<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span> <span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword keyword-ELSE">ELSE</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span> <span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-CASE">CASE</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p>O bien</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CASE">CASE</span>
    <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span> <span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword keyword-ELSE">ELSE</span>
        <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span> <span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-CASE">CASE</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p>Los diagramas de flujo de la estructura <strong><code>CASE</code></strong> son iguales a los de la estructura <strong><code>IF</code></strong> (variante 3).</p>
<p>Si realizamos el mismo ejemplo con <strong><code>CASE</code></strong> quedaría:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Procedimientos <code>CASE</code></strong><br>
Este ejemplo es igual que el ejemplo anterior pero resuelto utilizando la estructura condicional <strong><code>CASE</code></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> colorescase<span class="token punctuation">;</span>
<span class="token comment">/* Crear el procedimiento */</span>

<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> colorescase<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> num <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> num :<span class="token operator">=</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-CASE">CASE</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
            <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'verde'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.50</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
            <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'amarillo'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
            <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'naranja'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
        <span class="token keyword keyword-ELSE">ELSE</span>
            <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'rojo'</span> <span class="token keyword keyword-AS">AS</span> COLOR<span class="token punctuation">;</span>
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-CASE">CASE</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-CALL">CALL</span> colorescase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="estructuras-de-control-de-repetición">Estructuras de control de repetición </h4>
<p><strong>Sentencia WHILE</strong><br>
Otra estructura de control es la de bucles, que consisten en realizar de forma repetida un conjunto de instrucciones. Tenemos varias estructuras para hacer bucles como <strong><code>REPEAT</code></strong> o <strong><code>LOOP</code></strong>, pero nosotros usaremos <strong><code>WHILE</code></strong>.</p>
<div class="caso_estudio" style="font-weight:bold">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-WHILE">WHILE</span> <span class="token punctuation">[</span>condicion<span class="token punctuation">]</span> <span class="token keyword keyword-DO">DO</span>
    <span class="token punctuation">[</span>sentencia o bloque de sentencias<span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-WHILE">WHILE</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<p align="center" style="zoom:1" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="ACTIVITY" height="284px" preserveAspectRatio="none" style="width:794px;height:284px;background:#FFFFFF;" version="1.1" viewBox="0 0 794 284" width="794px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="431.5878" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"></ellipse><path d="M512.6902,102.725 L512.6902,121.431 L492.6902,125.431 L512.6902,129.431 L512.6902,148.137 A0,0 0 0 0 512.6902,148.137 L756.5754,148.137 A0,0 0 0 0 756.5754,148.137 L756.5754,112.725 L746.5754,102.725 L512.6902,102.725 A0,0 0 0 0 512.6902,102.725" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M746.5754,102.725 L746.5754,112.725 L756.5754,112.725 L746.5754,102.725" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.8852" x="518.6902" y="121.622">Este bloque de sentencias se ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58.812" x="518.6902" y="139.328">mientras</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.8821" x="580.8822" y="139.328">se cumpla la condición.</text><rect fill="#90EE90" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="122.2047" x="370.4854" y="107.2589"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102.2047" x="380.4854" y="130.087">bloque sentencias</text><polygon fill="#F1F1F1" points="406.6345,50,456.5411,50,468.5411,62,456.5411,74,406.6345,74,394.6345,62,406.6345,50" style="stroke:#181818;stroke-width:0.5;"></polygon><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="9.4159" x="435.5878" y="85.7589">Sí</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49.9066" x="406.6345" y="66.268">condición</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="15.7519" x="378.8826" y="58.777">No</text><path d="M10,185.603 L10,231.0151 A0,0 0 0 0 10,231.0151 L329.3893,231.0151 A0,0 0 0 0 329.3893,231.0151 L329.3893,212.309 L349.3893,208.309 L329.3893,204.309 L329.3893,195.603 L319.3893,185.603 L10,185.603 A0,0 0 0 0 10,185.603" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><path d="M319.3893,185.603 L319.3893,195.603 L329.3893,195.603 L319.3893,185.603" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"></path><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.8852" x="16" y="204.5">Este bloque de sentencias se ejecuta</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.689" x="16" y="222.2061">siempre</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.7003" x="68.689" y="222.2061">, se cumplan o no la condición del bucle.</text><rect fill="#F1F1F1" height="36.3441" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164.397" x="349.3893" y="190.137"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144.397" x="359.3893" y="212.9651">bloque sentencias común</text><ellipse cx="431.5878" cy="262.0151" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"></ellipse><ellipse cx="431.5878" cy="262.0151" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"></ellipse><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="431.5878" y1="74" y2="107.2589"></line><polygon fill="#181818" points="427.5878,97.2589,431.5878,107.2589,435.5878,97.2589,431.5878,101.2589" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="431.5878" y1="143.603" y2="158.137"></line><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="768.5754" y1="158.137" y2="158.137"></line><polygon fill="#181818" points="764.5754,115.94,768.5754,105.94,772.5754,115.94,768.5754,111.94" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="768.5754" x2="768.5754" y1="62" y2="158.137"></line><line style="stroke:#181818;stroke-width:1;" x1="768.5754" x2="468.5411" y1="62" y2="62"></line><polygon fill="#181818" points="478.5411,58,468.5411,62,478.5411,66,474.5411,62" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="394.6345" x2="358.4854" y1="62" y2="62"></line><polygon fill="#181818" points="354.4854,101.94,358.4854,111.94,362.4854,101.94,358.4854,105.94" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="358.4854" x2="358.4854" y1="62" y2="170.137"></line><line style="stroke:#181818;stroke-width:1;" x1="358.4854" x2="431.5878" y1="170.137" y2="170.137"></line><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="431.5878" y1="170.137" y2="190.137"></line><polygon fill="#181818" points="427.5878,180.137,431.5878,190.137,435.5878,180.137,431.5878,184.137" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="431.5878" y1="30" y2="50"></line><polygon fill="#181818" points="427.5878,40,431.5878,50,435.5878,40,431.5878,44" style="stroke:#181818;stroke-width:1;"></polygon><line style="stroke:#181818;stroke-width:1;" x1="431.5878" x2="431.5878" y1="226.4811" y2="251.0151"></line><polygon fill="#181818" points="427.5878,241.0151,431.5878,251.0151,435.5878,241.0151,431.5878,245.0151" style="stroke:#181818;stroke-width:1;"></polygon><!--SRC=[ZSwn3i8W40RWdQUunAMz61z0PrSNdm3ffSN0KJc8J-NavjeN4sAJrhYOCFo1dxjFaev9tGVh21eJkBF6JazkmGeqYEVfWTYgZRFzaFf8nFkB2xTC8CI9s5Wj1yKX4SHQKKSfSQvqwrQ9G5SoEMc5w6rvY5eGwxt9VdGQoba4EqNSGPrSmmn4F8Ng-KMKdtvwySVohq8i-J4IudPHC8IozTjIPZYuPEDefP8KHlK6]--></g></svg></p><p>En el siguiente ejemplo mostramos la suma de los 10 primeros números enteros.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Procedimientos <code>WHILE</code></strong><br>
En el siguiente ejemplo mostramos la suma de los 10 primeros números enteros.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> sumadieznumeros<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> sumadieznumeros<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> contador <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> resultado <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> resultado :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> contador :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-WHILE">WHILE</span> <span class="token punctuation">(</span>contador <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-DO">DO</span>
        <span class="token keyword keyword-SET">SET</span> resultado :<span class="token operator">=</span> resultado <span class="token operator">+</span> contador<span class="token punctuation">;</span>
        <span class="token keyword keyword-SET">SET</span> contador :<span class="token operator">=</span> contador <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-WHILE">WHILE</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> resultado <span class="token keyword keyword-AS">AS</span> <span class="token string">'SUMADIEZNUMEROS'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-CALL">CALL</span> sumadieznumeros<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="parámetros">Parámetros </h3>
<p>En muchas ocasiones los procedimientos necesitan recibir valores como parámetros. En MySQL podemos definir estas variables y usarlas dentro del procedimiento. En ejemplo siguiente, si queremos comparar dos cadenas y saber cuál tiene más carácteres, deberemos indicarle al procedimiento qué cadenas comparar.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Procedimientos parámetros</strong><br>
Este es un procedimiento al que se le pasan dos cadenas de carácteres como parámetros y muestra por pantalla que cadena tiene más carácteres.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> comparacadenas<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> comparacadenas<span class="token punctuation">(</span>cad1 <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cad2 <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-CASE">CASE</span>
    <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span>LENGTH<span class="token punctuation">(</span>cad1<span class="token punctuation">)</span> <span class="token operator">&gt;</span> LENGTH<span class="token punctuation">(</span>cad2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'La PRIMERA cadena es más larga'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">;</span>
    <span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span>LENGTH<span class="token punctuation">(</span>cad1<span class="token punctuation">)</span> <span class="token operator">&lt;</span> LENGTH<span class="token punctuation">(</span>cad2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'La SEGUNDA cadena es más larga'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">;</span>
    <span class="token keyword keyword-ELSE">ELSE</span>
        <span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'La dos cadenas miden lo mismo'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">;</span>
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-CASE">CASE</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-CALL">CALL</span> comparacadenas<span class="token punctuation">(</span><span class="token string">'Mi primera cadena'</span><span class="token punctuation">,</span><span class="token string">'Esta debe ser más larga'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="funciones-predefinidas">Funciones predefinidas </h2>
<p>Una función es un conjunto de líneas de código que realizan una tarea específica, al  igual  que un procedimiento, pero además puede retornar un valor.<br>
En MySQL existen multitud de funciones predefinidas. Se pueden consultar en la documentación oficial y en otras reconocidas:</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<ul>
<li><a href="https://www.w3schools.com/sql/sql_ref_mysql.asp">MySQL Oficial – Funciones en MySQL – Web W3SCHOOLS Interactiva</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/functions.html">MySQL Oficial – Funciones en MySQL – Web Oficial en inglés</a></li>
<li><a href="http://ftp.tcrc.edu.tw/MySQL/doc/refman/5.0/es/functions.html">MySQL Oficial – Funciones en MySQL – Web en español</a></li>
<li><a href="http://mysql.conclase.net/curso/?cap=011">MySQL Oficial – Funciones en MySQL – Ejemplos</a></li>
</ul>
</div>
<p>Los procedimiento y las funciones son utilizadas para descomponer grandes problemas en tareas simples y para implementar operaciones que son comúnmente utilizadas durante un programa y de esta manera reducir la cantidad de código.</p>
<p>Cuando una función es invocada/llamada, se le pasa el control a la misma, y una vez  que esta finaliza devuelve el control al punto desde el cual fue llamada.</p>
<p>Las funciones pueden tomar parámetros que modifiquen su funcionamiento.</p>
<h3 id="funciones-matemáticas">Funciones matemáticas </h3>
<p>Las que más vamos a usar son: <strong>ABS, FLOOR, MOD, POW, SQRT, RAND, ROUND</strong> y <strong>SIGN</strong>.</p>
<p>La siguiente tabla describe la sintaxis y qué hace cada función.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Función</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ABS(x)</strong></td>
<td style="text-align:left">Retorna el valor absoluto de <em>x</em>. El valor absoluto de un número positivo es el mismo número y el de un número negativo es el número cambiado de signo.</td>
</tr>
<tr>
<td style="text-align:left"><strong>FLOOR(x)</strong></td>
<td style="text-align:left">Retorna la parte entera de <em>x</em>. Si representamos los números en la recta real, la parte entera es el entero más próximo a la izquierda del número.</td>
</tr>
<tr>
<td style="text-align:left"><strong>MOD(x, y)</strong></td>
<td style="text-align:left">Retorna el resto de la división entera de <em>x</em> entre <em>y</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>POW(x, y)</strong></td>
<td style="text-align:left">Retorna <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SQRT(x)</strong></td>
<td style="text-align:left">Retorna la raíz cuadrada de <em>x</em>; o sea <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mi>x</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt {x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.2397em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8003em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">x</span></span></span><span style="top:-2.7603em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2397em;"><span></span></span></span></span></span></span></span></span>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>RAND()</strong></td>
<td style="text-align:left">Genera un número aleatorio real entre 0 y 1 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x \in [0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>).</td>
</tr>
<tr>
<td style="text-align:left"><strong>ROUND(x, d)</strong> <strong>ROUND(x)</strong></td>
<td style="text-align:left">Redondea el número <em>x</em> con <em>d</em> decimales. Si no se pasa el parámetro <em>d</em> redondea al entero más cercano. Si representamos x en la recta real, la función ROUND devuelve el número más cercano con la precisión especificada.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SIGN(x)</strong></td>
<td style="text-align:left">Retorna 1 si <em>x</em> es positivo, -1 si <em>x</em> es negativo y 0 si <em>x</em> es igual a 0.</td>
</tr>
</tbody>
</table>
<p>A continuación vamos a ver algunos ejemplos de utilización de estas funciones.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Valor absoluto de un número</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: 17</span>
<span class="token keyword keyword-SELECT">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 25.15</span>
 <span class="token keyword keyword-SELECT">SELECT</span> ABS<span class="token punctuation">(</span><span class="token number">25.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Vemos que podemos calcular el valor absoluto de cualquier número sea real o entero.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Parte entera de un número</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code> <span class="token comment">-- Salida: 35</span>
<span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token number">35.789</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">-- Salida: 12</span>
<span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token number">12.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: -36</span>
 <span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">35.789</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: -13</span>
 <span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>El cálculo de la parte entera para los números positivos es basatante evidente. Para los números negativos el resultado puede parecer un poco chocante, pero si nos atenemos a la definición se entiende el por qué, por ejemplo, la parte entera de -12.2 es -13.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Resto de una división entre dos número enteros</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: 3</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 0</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: -4</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>El resto de la división entera siempre será menor que el divisor. Por ejemplo, si el divisor es 4 entoces los restos posibles son 0, 1, 2 y 3.<br>
Cuando el dividendo o el divisor es negativo entonces el resto de la división es negativo.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Ejemplo 4 - Potencia de un número</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: 8</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: -8</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 0.25</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 0.125</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 28.196099999999994</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">5.31</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 3428.0987096370227</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">5.31</span><span class="token punctuation">,</span> <span class="token number">4.8753</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 0.0002917068861491106</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">5.31</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.8753</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 9.192037038104349</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1.14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: -0.00667907679209098</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5.31</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: Error - #1690 - DOUBLE value is out of range in 'pow(-4,0.5)'</span>
<span class="token keyword keyword-select">select</span> POW<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><p>En los ejemplos vemos que podemos calcular potencias con bases y exponentes de cualquier signo sean enteros o reales.<br>
Cuando la base es negativa puede producirse un error como en el último ejemplo. La instrucción <strong><code>POW(-4, 0.5)</code></strong> realmente calcula raíz cuadrada de -4, y la raíz cuadarda de un número negativo no exixte.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Raíz cuadrada de un número</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: 8</span>
 <span class="token keyword keyword-SELECT">SELECT</span> SQRT<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 8 (otra forma alternativa de calcular la raíz cuadrada)</span>
 <span class="token keyword keyword-SELECT">SELECT</span> POW<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Entre la potencia y la raíz cuadrada hay la siguiente equivalencia: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>0.5</mn></msup><mo>=</mo><msup><mi>x</mi><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup><mo>=</mo><msqrt><mi>x</mi></msqrt></mrow><annotation encoding="application/x-tex">x ^ {0.5} = x ^ {1/2} = \sqrt {x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.5</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.2397em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8003em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">x</span></span></span><span style="top:-2.7603em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2397em;"><span></span></span></span></span></span></span></span></span>.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Número aleatorio real</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: x ∈ [0, 1)</span>
<span class="token keyword keyword-SELECT">SELECT</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: x ∈ [0, 5)</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token number">5</span> <span class="token operator">*</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>La función <strong><code>RAND</code></strong> genera un número real aleatorio <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x \in [0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>. En el segundo ejemplo, al multiplicar la función por 5 obtenemos un número real aleatorio <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x \in [0, 5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mclose">)</span></span></span></span>.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p><strong>Redondear un número real hasta los decimales que se indiquen</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Resultado: 45.3</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">45.267</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: -45.27</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45.267</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: 45</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">45.267</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: 46</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">45.75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: -45</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45.267</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: -46</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: 5.2</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">5.15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Resultado: -5.2</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5.15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Según la definición, la función <strong><code>ROUND</code></strong> retorna el número, con la precisión especificada, más cercano al número dado.<br>
En el primer ejemplo retorna 45.3 por que 45.267 está más cerca de 45.3 que de 45.2.<br>
Los dos últimos casos son especiales por que el número está a igual distancia de dos números con la precisión dada. Por ejemplo, 5.15 está a igual distancia de 5.1 que de 5.2 y -5.15 está a igual distancia de -5.1 y -5.2. En estos casos se coge el de su derecha para los números positivos y el de su izquierda para números negativos.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 8</p>
<p><strong>Obtiene el signo del número</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Salida: -1</span>
<span class="token keyword keyword-SELECT">SELECT</span> SIGN<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 1</span>
<span class="token keyword keyword-SELECT">SELECT</span> SIGN<span class="token punctuation">(</span><span class="token number">45.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Salida: 0</span>
<span class="token keyword keyword-SELECT">SELECT</span> SIGN<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Para mayor información podéis consultar la información de las referencias.</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<ul>
<li><a href="http://mysql.conclase.net/curso/?cap=011#FUN_MATEMATICAS">MySQL – Funciones matemáticas - Con Clase</a></li>
<li><a href="https://www.w3schools.com/sql/sql_ref_mysql.asp">MySQL – Funciones en MySQL – Web W3SCHOOLS Interactiva</a></li>
</ul>
</div>
<h3 id="funciones-de-cadenas-o-strings">Funciones de cadenas o strings </h3>
<p>Las que más vamos a usar son: <strong>CONCAT, UPPER, LOWER, LEFT, RIGHT, SUBSTRING, SUBSTRING_INDEX,INSTR, LENGTH, TRIM, REPEAT, REPLACE, REVERSE</strong> y <strong>STRCMP</strong>.</p>
<p>La siguiente tabla describe la sintaxis y qué hace cada función.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Función</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>CONCAT(c1, c2, ...)</strong></td>
<td style="text-align:left">Retorna una cadena con la concatenación de todas las cadenas que se pasan como parámetro (<em>c1</em>, <em>c2</em>, ...).</td>
</tr>
<tr>
<td style="text-align:left"><strong>UPPER(c)</strong></td>
<td style="text-align:left">Retorna la cadena resultatnte de pasar la cadena <em>c</em> a mayúsculas. La función UCASE es equivalente a esta.</td>
</tr>
<tr>
<td style="text-align:left"><strong>LOWER(c)</strong></td>
<td style="text-align:left">Retorna la cadena resultatnte de pasar la cadena <em>c</em> a minúsculas. La función LCASE es equivalente a esta.</td>
</tr>
<tr>
<td style="text-align:left"><strong>LEFT(c, k)</strong></td>
<td style="text-align:left">Retorna el prefijo de la cadena <em>c</em> de <em>k</em> carácteres.</td>
</tr>
<tr>
<td style="text-align:left"><strong>RIGHT(c, k)</strong></td>
<td style="text-align:left">Retorna el sufijo de la cadena <em>c</em> de <em>k</em> carácteres.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SUBSTRING(c, k, l)</strong></td>
<td style="text-align:left">Retorna la subcadena <em>c</em> cuto primer carácter comienza en la posició <em>k</em> y tiene <em>l</em> carácteres. Si no se especifica el tercer parámetro se coge la subcadena que comienza en la posición <em>k</em> hasta el final.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SUBSTRING_INDEX(c, pt, k)</strong></td>
<td style="text-align:left">Hay que distinguir 2 casos en función de si <em>k</em> es positivo o negativo. Si <em>k</em> es positivo entonces se busca, comenzando por la izquierda, la k-ésima aparición  del patrón en la cadena <em>c</em> y retorna la cadena que está a su izquierda. Si <em>k</em> es negativo entonces se busca, comenzando por la derecha, la <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">∣</mo><mi>k</mi><mo fence="true">∣</mo></mrow><annotation encoding="application/x-tex">\left | k \right |</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose delimcenter" style="top:0em;">∣</span></span></span></span></span>-ésima aparición  del patrón en la cadena <em>c</em> y retorna la cadena que está a su derecha.</td>
</tr>
<tr>
<td style="text-align:left"><strong>INSTR(c, c2)</strong></td>
<td style="text-align:left">Comprueba si la cadena <em>c2</em> está contenida en <em>c</em>. Si está contenida retorna la posición de donde empieza la cadena <em>c2</em> en <em>c</em>, si no retorna 0.</td>
</tr>
<tr>
<td style="text-align:left"><strong>LENTGTH(c)</strong></td>
<td style="text-align:left">Retorna la cantidad de carácteres de la cadena <em>c</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>TRIM(c)</strong></td>
<td style="text-align:left">Retorna la cadena una cadena como <em>c</em> pero donde se han eliminado los espacios en blanco (espacio, tabulador o salta de línea) del principio y del final de <em>c</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>REPEAT(c, k)</strong></td>
<td style="text-align:left">Retorna la cadena resultante de concatenar <em>c</em> consigo mismo <em>k</em> veces.</td>
</tr>
<tr>
<td style="text-align:left"><strong>REPLACE(c, cb, cr)</strong></td>
<td style="text-align:left">Retorna la cadena resultante de sustituir todas las apariciones de la cadena <em>cb</em> en <em>c</em> por la cadena <em>cr</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>REVERSE(c)</strong></td>
<td style="text-align:left">Invierte una cadena de carácteres. Retorna una cadena igual a la cadena <em>c</em> pero empezando por el último carácter y acabando por el primero.</td>
</tr>
<tr>
<td style="text-align:left"><strong>STRCMP(c1, c2)</strong></td>
<td style="text-align:left">Retorna -1, 0 ó 1 si la cadena <em>c1</em> es menor, igual o mayor que <em>c2</em> sgún el orden llexicográfico.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>📌 <strong>Orden lexicográfico</strong><br>
Para comparar 2 cadenas de carácteres se comienza por el primer de carácter de ambas cadenas y mientras los carácteres sean iguales se pasa al siguiente hasta que los carácteres de la misma posición sean diferentes o se llegue al final de una de las cadenas. Si hemos encontrado 2 carácteres diferentes entonces la cadena mayor es la correspondiente a la que tenga un carácter con mayor valor ascii (o unicode). Si se ha llegado al final de una de las cadenas entonces la mayor es la otra. Si ambas cadenas son de la misma longitud y tienen los mismos carácteres entoces son iguales.</p>
</blockquote>
<p>A continuación vamos a ver algunos ejemplos de utilización de estas funciones.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Concatenar varias cadenas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'Juan '</span><span class="token punctuation">,</span><span class="token string">'López '</span><span class="token punctuation">,</span><span class="token string">'García'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> NOMBRE<span class="token punctuation">;</span>
<span class="token comment">/*
+--------------------+
 | NOMBRE            |
 +-------------------+
 | Juan López García |
 +-------------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Pasar a mayúsculas/minúsculas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Pasar a mayúsculas.</span>
<span class="token keyword keyword-SELECT">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'Soy alumno de FP'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> MENSAJE<span class="token punctuation">;</span>
<span class="token comment">/*
+------------------+
| MENSAJE          |
+------------------+
| SOY ALUMNO DE FP |
+------------------+
*/</span>

<span class="token comment">-- Pasar a minúsculas.</span>
<span class="token keyword keyword-SELECT">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'Soy alumno de FP'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> MENSAJE<span class="token punctuation">;</span>
<span class="token comment">/*
+------------------+
| MENSAJE          |
+------------------+
| soy alumno de fp |
+------------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Prefijos y sufijos</strong><br>
El primer ejemplo obtiene el nombre de la persona y el segundo su segundo apellido.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Cuatro primeros carécteres.</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-LEFT">LEFT</span><span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> NOMBRE<span class="token punctuation">;</span>
<span class="token comment">/*
+--------+
| NOMBRE |
+--------+
| Juan   |
+--------+
*/</span>

<span class="token comment">-- Seis últimos carécteres.</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-RIGHT">RIGHT</span><span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> APELLIDO2<span class="token punctuation">;</span>
<span class="token comment">/*
+-----------+
| APELLIDO2 |
+-----------+
| García    |
+-----------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Subcadenas con <code>SUBSTRING</code></strong><br>
El primer ejemplo obtiene el primer apellido de la persona y el segundo sus apellidos.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener subcadena de 5 carácteres que comienza en la posición 6 */</span>
<span class="token keyword keyword-SELECT">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> APELLIDO1<span class="token punctuation">;</span>
<span class="token comment">/*
+-----------+
| APELLIDOS |
+-----------+
| López     |
+-----------+
*/</span>

<span class="token comment">/* Obtener subcadena que comienza en la posición 6 hasta el final */</span>
<span class="token keyword keyword-SELECT">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> APELLIDOS<span class="token punctuation">;</span>
<span class="token comment">/*
+-----------------+
| APELLIDO1       |
+-----------------+
| López García    |
+-----------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Subcadenas con <code>SUBSTRING_INDEX</code></strong><br>
El primer ejemplo obtiene el nombre de la máquina a partir del nombre FQDN.<br>
El segundo obtiene el nombre del dominio a partir del nombre FQDN.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> SUBSTRING_INDEX<span class="token punctuation">(</span><span class="token string">'www.iesdoctorbalmis.com'</span><span class="token punctuation">,</span> <span class="token string">'.'</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> MAQUINA<span class="token punctuation">;</span>
<span class="token comment">/*
+----------+
| MAQUINA  |
+----------+
| www      |
+----------+
*/</span>

<span class="token keyword keyword-SELECT">SELECT</span> SUBSTRING_INDEX<span class="token punctuation">(</span><span class="token string">'www.iesdoctorbalmis.com'</span><span class="token punctuation">,</span> <span class="token string">'.'</span> <span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> DOMINIO<span class="token punctuation">;</span>
<span class="token comment">/*
+----------------------+
| DOMINIO              |
+----------------------+
| iesdoctorbalmis.com  |
+----------------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Posición de una cadena dentro de otra</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> INSTR<span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span><span class="token string">'López'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> POSICION<span class="token punctuation">;</span>
<span class="token comment">/*
+----------+
| POSICION |
+----------+
|        6 |
+----------+
*/</span>

<span class="token keyword keyword-SELECT">SELECT</span> INSTR<span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">,</span><span class="token string">'Martínez'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> POSICION<span class="token punctuation">;</span>
<span class="token comment">/*
+----------+
| POSICION |
+----------+
|        0 |
+----------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p><strong>Número de carácteres de una cadena</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener la longitud de una cadena */</span>
<span class="token keyword keyword-SELECT">SELECT</span> LENGTH<span class="token punctuation">(</span><span class="token string">'Juan López García'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> LONGITUD<span class="token punctuation">;</span>
<span class="token comment">/*
+----------+
| LONGITUD |
+----------+
|       17 |
+----------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 8</p>
<p><strong>Eliminar espacios en blanco por delante y por detrás</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'    Juan López García      '</span> <span class="token keyword keyword-AS">AS</span> SUCIO<span class="token punctuation">,</span> TRIM<span class="token punctuation">(</span><span class="token string">'    Juan López García      '</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> LIMPIO<span class="token punctuation">;</span>
<span class="token comment">/*
+----------------------------+-------------------+
| SUCIO                      | LIMPIO            |
+----------------------------+-------------------+
|     Juan López García      | Juan López García |
+----------------------------+-------------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 9</p>
<p><strong>Concatenar cadena consigo mismo</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-REPEAT">REPEAT</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+-----------------+
| REPEAT('abc',5) |
+-----------------+
| abcabcabcabcabc |
+-----------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 10</p>
<p><strong>Reemplazo de subcadenas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-REPLACE">REPLACE</span><span class="token punctuation">(</span><span class="token string">'SQL Tutorial'</span><span class="token punctuation">,</span> <span class="token string">'SQL'</span><span class="token punctuation">,</span> <span class="token string">'HTML'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> REEMPLAZADO<span class="token punctuation">;</span>
<span class="token comment">/*
+---------------+
| REEMPLAZADO   |
+---------------+
| HTML Tutorial |
+---------------+
*/</span>

<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-REPLACE">REPLACE</span><span class="token punctuation">(</span><span class="token string">'Subcadena: una cadena dentro de otra Cadena'</span><span class="token punctuation">,</span> <span class="token string">'cadena'</span><span class="token punctuation">,</span> <span class="token string">'CADENA'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> REEMPLAZADO<span class="token punctuation">;</span>
<span class="token comment">/*
+---------------------------------------------+
| REEMPLAZADO                                 |
+---------------------------------------------+
| SubCADENA: una CADENA dentro de otra Cadena |
+---------------------------------------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 11</p>
<p><strong>Invertir cadenas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> REVERSE<span class="token punctuation">(</span><span class="token string">'SQL Tutorial'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> INVERSA<span class="token punctuation">;</span>
<span class="token comment">/*
+--------------+
| INVERSA      |
+--------------+
| lairotuT LQS |
+--------------+
*/</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 12</p>
<p><strong>Comparar cadenas</strong><br>
De los diferentes casos del ejemplo se deduce que no se hace distinción entre minúsculas y mayúsculas ni entre letras con tilde y sin tilde.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Perro &gt; Gato</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'Perro'</span><span class="token punctuation">,</span><span class="token string">'Gato'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|           1 |
+-------------+
*/</span>

<span class="token comment">-- Gato &lt; Loro</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'Gato'</span><span class="token punctuation">,</span><span class="token string">'Loro'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|          -1 |
+-------------+
*/</span>

<span class="token comment">-- Perro = Perro</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'Perro'</span><span class="token punctuation">,</span><span class="token string">'Perro'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|           0 |
+-------------+
*/</span>

<span class="token comment">-- perro = Perro</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'perro'</span><span class="token punctuation">,</span><span class="token string">'Perro'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|           0 |
+-------------+
*/</span>

<span class="token comment">-- Gato Montés &gt; Gato</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'Gato Montés'</span><span class="token punctuation">,</span><span class="token string">'Gato'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|           1 |
+-------------+
*/</span>

<span class="token comment">-- Águila &gt; Aguila</span>
<span class="token keyword keyword-SELECT">SELECT</span> STRCMP<span class="token punctuation">(</span><span class="token string">'Águila'</span><span class="token punctuation">,</span><span class="token string">'Aguila'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> COMPARACION<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| COMPARACION |
+-------------+
|           0 |
+-------------+
*/</span>
</code></pre></div>
<p>Para mayor información podéis consultar la información de las referencias.</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<ul>
<li><a href="http://mysql.conclase.net/curso/?cap=011#FUN_CADENAS">MySQL – Funciones de cadenas de carácteres - Con Clase</a></li>
<li><a href="https://www.w3schools.com/sql/sql_ref_mysql.asp">MySQL – Funciones en MySQL – Web W3SCHOOLS Interactiva</a></li>
</ul>
</div>
<h3 id="funciones-de-fechas">Funciones de fechas </h3>
<p>Las que más vamos a usar son: <strong>CURDATE, CURTIME, NOW, ADDDATE, ADDTIME, DATEDIFF, TIMEDIFF, DAY, MONTH, YEAR, DAYOFWEEK, DAYNAME, HOUR, MINUTE, SECOND, SEC_TO_TIME, TIME_TO_SEC, MAKETIME, STR_TO_DATE</strong> y <strong>DATE_FORMAT</strong>.</p>
<p>La siguiente tabla describe la sintaxis y qué hace cada función.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Función</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>CURDATE()</strong></td>
<td style="text-align:left">Retorna la fecha actual.</td>
</tr>
<tr>
<td style="text-align:left"><strong>CURTIME()</strong></td>
<td style="text-align:left">Retorna la hora actual.</td>
</tr>
<tr>
<td style="text-align:left"><strong>NOW()</strong></td>
<td style="text-align:left">Retorna la fecha y la hora actual.</td>
</tr>
<tr>
<td style="text-align:left"><strong>ADDDATE(f, d)</strong></td>
<td style="text-align:left">Dada una fecha <em>f</em> retorna la fecha resultante de sumarle <em>d</em> días (positivos o negativos).</td>
</tr>
<tr>
<td style="text-align:left"><strong>ADDTIME(t, s)</strong></td>
<td style="text-align:left">Retorna el tiempo resultatnte de sumarle al tiempo <em>t</em> <em>s</em> segundos.</td>
</tr>
<tr>
<td style="text-align:left"><strong>DATEDIFF(f1, f2)</strong></td>
<td style="text-align:left">Retorna los días que hay entre las fechas <em>f1</em> y <em>f2</em> (<em>f1</em> - <em>f2</em>).</td>
</tr>
<tr>
<td style="text-align:left"><strong>TIMEDIFF(t1, t2)</strong></td>
<td style="text-align:left">Retorna los segundos entre los instantes de tiempo <em>t1</em> y <em>t2</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>DAY(f)</strong></td>
<td style="text-align:left">Retorna el día del més correspondiente a la fecha <em>f</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>MONTH(f)</strong></td>
<td style="text-align:left">Retorna el número de més correspondiente a la fecha <em>f</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>YEAR(f)</strong></td>
<td style="text-align:left">Retorna el año correspondiente a la fecha <em>f</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>DAYOFWEEK(f)</strong></td>
<td style="text-align:left">Retorna el número de día de la semana correspondiente a la fecha <em>f</em> (el día 1 es el domingo).</td>
</tr>
<tr>
<td style="text-align:left"><strong>DAYNAME(f)</strong></td>
<td style="text-align:left">Retorna el día de la semana correspondiente a la fecha <em>f</em> (en inglés).</td>
</tr>
<tr>
<td style="text-align:left"><strong>HOUR(t)</strong></td>
<td style="text-align:left">Retorna la hora correspondiente al instante de tiempo <em>t</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>MINUTE(t)</strong></td>
<td style="text-align:left">Retorna los minutos correspondientes al instante de tiempo <em>t</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SECOND(t)</strong></td>
<td style="text-align:left">Retorna los segundos correspondientes al instante de tiempo <em>t</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>SEC_TO_TIME(s)</strong></td>
<td style="text-align:left">Retorna el instante de tiempo correpondiente a los segundos <em>s</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>TIME_TO_SEC(t)</strong></td>
<td style="text-align:left">Retorna los segundos correpondientes al instante de tiempo <em>t</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>MAKETIME(h, m, s)</strong></td>
<td style="text-align:left">Retorna un instante de tiempo a partir de las horas <em>h</em>, minutos <em>m</em> y segundos <em>s</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>STR_TO_DATE(cf, ff)</strong></td>
<td style="text-align:left">Retorna una fecha a partir de la cadena <em>cf</em> y una cadena de formato de fecha <em>ff</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>DATE_FORMAT(f, ff)</strong></td>
<td style="text-align:left">Retorna una cadena que representa la fecha <em>f</em> (o parte de ella) según las indicaciones del patrón de fecha <em>ff</em>.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Fechas y horas actuales</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">-- Obtener la FECHA actual</span>
<span class="token keyword keyword-SELECT">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Obtener la HORA actual</span>
<span class="token keyword keyword-SELECT">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Obtener la FECHA Y HORA actual</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Añadir días a fechas y segundos a tiempo</strong><br>
Podemos ver como se pueden obtener fechas posteriores o anteriores. La función tiene en cuenta los días de cada més y también si el año es bisiesto o no.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Añadir días a un FECHA (DATE O DATETIME) */</span>
<span class="token comment">-- Salida: 2018-04-06</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDDATE<span class="token punctuation">(</span><span class="token string">'2018-03-25'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 2020-02-29</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDDATE<span class="token punctuation">(</span><span class="token string">'2020-03-25'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 2021-02-28</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDDATE<span class="token punctuation">(</span><span class="token string">'2021-03-25'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Añadir segundos a un TIME o DATETIME */</span>
<span class="token comment">-- Salida: 09:35:06</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'09:34:21'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 09:33:36</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'09:34:21'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Añadir segundos a un DATETIME */</span>
<span class="token comment">-- Salida: 2018-03-25 09:35:06</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'2018-03-25 09:34:21'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 2019-05-16 01:34:21</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'2018-03-25 09:34:21'</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 2017-02-01 17:34:21</span>
<span class="token keyword keyword-SELECT">SELECT</span> ADDTIME<span class="token punctuation">(</span><span class="token string">'2018-03-25 09:34:21'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Diferencia de días entre fechas y de segundos entre tiempos</strong><br>
Si la primera fecha es anterior a la segunda el resultado es negativo. Análogamente con los tiempos.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Diferencia de días entre dos FECHAS */</span>
<span class="token comment">-- Salida: 43</span>
<span class="token keyword keyword-SELECT">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">'2018-03-25'</span><span class="token punctuation">,</span> <span class="token string">'2018-02-10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: -43</span>
<span class="token keyword keyword-SELECT">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">'2018-02-10'</span><span class="token punctuation">,</span> <span class="token string">'2018-03-25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Diferencia de segundos entre dos TIEMPOS en formato hh:mm:ss */</span>
<span class="token comment">-- Salida: 00:29:30</span>
<span class="token keyword keyword-SELECT">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">'20:00:00'</span><span class="token punctuation">,</span><span class="token string">'19:30:30'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: -00:29:30</span>
<span class="token keyword keyword-SELECT">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">'19:30:30'</span><span class="token punctuation">,</span> <span class="token string">'20:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Datos relacionados con las fechas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener el valor del DÍA de una FECHA */</span>
<span class="token comment">-- Salida: 25</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-DAY">DAY</span><span class="token punctuation">(</span><span class="token string">'2018-03-25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener el valor del MES de una FECHA */</span>
<span class="token comment">-- Salida: 3</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-MONTH">MONTH</span><span class="token punctuation">(</span><span class="token string">'2018-03-25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener el valor del AÑO de una FECHA */</span>
<span class="token comment">-- Salida: 2018</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-YEAR">YEAR</span><span class="token punctuation">(</span><span class="token string">'2018-03-25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener el número de día de la semana de una FECHA */</span>
<span class="token comment">-- Salida: 1 (1 &lt;--&gt; Domingo)</span>
<span class="token keyword keyword-SELECT">SELECT</span> DAYOFWEEK<span class="token punctuation">(</span><span class="token string">'2018-03-25 10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener nombre del día de la semana de una FECHA */</span>
<span class="token comment">-- Salida: Sunday</span>
<span class="token keyword keyword-SELECT">SELECT</span> DAYNAME<span class="token punctuation">(</span><span class="token string">'2018-03-25 10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Datos relacionados con los tiempos</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener el valor de HORA de un TIME o DATETIME */</span>
<span class="token comment">-- Salida: 10</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-HOUR">HOUR</span><span class="token punctuation">(</span><span class="token string">'10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: 10</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-HOUR">HOUR</span><span class="token punctuation">(</span><span class="token string">'2018-03-25 10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener el valor de minutos de un TIME o DATETIME */</span>
<span class="token comment">-- Salida: 36</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-MINUTE">MINUTE</span><span class="token punctuation">(</span><span class="token string">'10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Obtener el valor de segundos de un TIME o DATETIME */</span>
<span class="token comment">-- Salida: 15</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-SECOND">SECOND</span><span class="token punctuation">(</span><span class="token string">'10:36:15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Conversión segundos/tiempo y tiempo/segundos</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener el valor de formato hh:mm:ss a partir de los segundos */</span>
<span class="token comment">-- Salida: 01:01:40</span>
<span class="token keyword keyword-SELECT">SELECT</span> SEC_TO_TIME<span class="token punctuation">(</span><span class="token number">3700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener los segundos a partir del tiempo (hh:mm:ss) */</span>
<span class="token comment">-- Salida: 3700</span>
<span class="token keyword keyword-SELECT">SELECT</span> TIME_TO_SEC<span class="token punctuation">(</span><span class="token string">'01:01:40'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p><strong>Crear tiempo a partir de horas, minutos y segundos</strong><br>
Los segundos y minutos tienen que estar entre 0 y 59. De no ser así retorna <strong><code>NULL</code></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener tiempo en formato hh:mm:ss a partir de las horas, minutos y segundos */</span>
<span class="token comment">-- Salida: 20:30:52</span>
<span class="token keyword keyword-SELECT">SELECT</span> MAKETIME<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Salida: NULL</span>
<span class="token keyword keyword-SELECT">SELECT</span> MAKETIME<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p><strong>Trabajando con formatos de fechas</strong><br>
El formato de fecha sirve para indicarle a MySQL como debe interpretar los elementos de una fecha para crear una cadena que representa una fecha o para crear una fecha a partir de una cadena.<br>
Con <strong><code>%&lt;letra&gt;</code></strong> indicamos una propiedad de la fecha. Por ejemplo <strong><code>%d</code></strong> es el día del mes, <strong>%<code>m</code></strong> el número de mes y <strong><code>%Y</code></strong> el año con 4 dígitos (<strong><code>%y</code></strong> serían las 2 últimas cifras del año). Para mayor información mirar las referéncias.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Obtener una fecha a partir de una cadena y un formato de fecha */</span>
<span class="token comment">-- Salida: 2018-02-12</span>
<span class="token keyword keyword-SELECT">SELECT</span> STR_TO_DATE<span class="token punctuation">(</span><span class="token string">'12/02/2018'</span><span class="token punctuation">,</span><span class="token string">'%d/%m/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Obtener una representación de una fecha con el formato utilizado en España */</span>
<span class="token comment">-- Salida: 15/03/2018</span>
<span class="token keyword keyword-SELECT">SELECT</span> DATE_FORMAT<span class="token punctuation">(</span><span class="token string">'2018-03-15'</span><span class="token punctuation">,</span><span class="token string">'%d/%m/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Para profundizar en las funciones de tratamiento de fechas consultar:</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<p><a href="http://mysql.conclase.net/curso/?cap=011a#FUN_FECHA">MySQL – Funciones de fechas - ConClase</a><br>
<a href="https://www.w3schools.com/sql/sql_ref_mysql.asp">MySQL – Funciones en MySQL – Web W3SCHOOLS Interactiva</a></p>
</div>
<h3 id="funciones-avanzadas">Funciones avanzadas </h3>
<p>Las que más vamos a usar son: <strong>VERSION, DATABASE, CURRENT_USER, CONVERT, ISNULL, IFNULL, IF</strong> y <strong>CASE</strong>.</p>
<h4 id="funciones-avanzadas-para-mostrar-información">Funciones avanzadas para mostrar INFORMACIÓN </h4>
<table>
<thead>
<tr>
<th style="text-align:left">Función</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>VERSION()</strong></td>
<td style="text-align:left">Retorna la versión de MySQL.</td>
</tr>
<tr>
<td style="text-align:left"><strong>DATABASE()</strong></td>
<td style="text-align:left">Retorna la base de datos seleccionada.</td>
</tr>
<tr>
<td style="text-align:left"><strong>CURRENT_USER()</strong></td>
<td style="text-align:left">Retorna el usuario con el que estoy conectado a la base de datos.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Ejemplos de funciones predefinidas avanzadas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Mostrar la versión de MySQL */</span>
<span class="token keyword keyword-SELECT">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+-----------------+
| VERSION()       |
+-----------------+
| 10.4.32-MariaDB |
+-----------------+
*/</span>

<span class="token comment">/* Mostrar la base de datos seleccionada por defecto */</span>
<span class="token keyword keyword-USE">USE</span> world<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-DATABASE">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+------------+
| DATABASE() |
+------------+
| world      |
+------------+
*/</span>

<span class="token comment">/* Mostrar el usuario con el que estamos conectados */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-CURRENT_USER">CURRENT_USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+----------------+
| CURRENT_USER() |
+----------------+
| root@localhost |
+----------------+
*/</span>
</code></pre></div>
<h4 id="funciones-avanzadas-para-conversión-de-valores">Funciones avanzadas para CONVERSIÓN DE VALORES </h4>
<table>
<thead>
<tr>
<th style="text-align:left">Función</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>CONVERT(parm, tp)</strong></td>
<td style="text-align:left">Retorna el resultado de la conversión del valor <em>parm</em> al tipo especificado en <em>tp</em>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>ISNULL(var)</strong></td>
<td style="text-align:left">Retorna 1 si la variable <em>var</em> tiene un valor asignado y 0 si no tiene ninguno.</td>
</tr>
<tr>
<td style="text-align:left"><strong>IFNULL(parm, msg)</strong></td>
<td style="text-align:left">Si <em>parm</em> es <strong><code>NULL</code></strong> retorna msg si no retorna <em>parm</em></td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Ejemplos de funciones predefinidas avanzadas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Convertir cadenas de carácteres a números */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-CONVERT">CONVERT</span><span class="token punctuation">(</span><span class="token string">'45.7'</span><span class="token punctuation">,</span> <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+--------------------------------+
| CONVERT('45.7', DECIMAL(10,2)) |
+--------------------------------+
|                          45.70 |
+--------------------------------+
*/</span>

<span class="token comment">/* Convertir números a cadenas*/</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-CONVERT">CONVERT</span><span class="token punctuation">(</span><span class="token number">45.7</span><span class="token punctuation">,</span> <span class="token keyword keyword-CHAR">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+---------------------+
| CONVERT(45.7, CHAR) |
+---------------------+
|                45.7 |
+---------------------+
*/</span>

<span class="token comment">/* Comprobar si un valor es NULL */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span>
<span class="token comment">/*
+------+
| @num |
+------+
| NULL |
+------+
*/</span>

<span class="token keyword keyword-SELECT">SELECT</span> ISNULL<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+--------------+
| ISNULL(@num) |
+--------------+
|            1 |
+--------------+
*/</span>

<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> ISNULL<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+--------------+
| ISNULL(@num) |
+--------------+
|            0 |
+--------------+
*/</span>

<span class="token comment">/* Decidir qué valor mostrar si el resultado es NULL */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">,</span> <span class="token string">'Error en división'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------------+
| RESULTADO         |
+-------------------+
| Error en división |
+-------------------+
*/</span>

<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">,</span> <span class="token string">'Error en división'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| RESULTADO   |
+-------------+
| 5.000000000 |
+-------------+
*/</span>
</code></pre></div>
<h4 id="funciones-avanzadas-para-programación">Funciones avanzadas para PROGRAMACIÓN </h4>
<p>La función <strong>IF(condicion, p1, p2)</strong>  retorna p1 si se cumple la condición y p2 si no se cumple.</p>
<p>El constructo:<br>
<strong>CASE<br>
WHEN condicion1 THEN c1<br>
. . .<br>
WHEN condicionN THEN cN<br>
ELSE cE<br>
END</strong><br>
retorna <em>c1</em> si se cumple <em>condicion1</em>, <em>c2</em> si se cumple <em>condicion2</em>, . . . , <em>cN</em> si se cumple <em>condicionN</em> y <em>cE</em> si no se cumple ninguna condición de las cláusulas <strong><code>WHEN</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Ejemplos de funciones predefinidas avanzadas</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Mostrar valores teniendo en cuenta una condición */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num1</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num2</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">(</span><span class="token variable">@num1</span><span class="token operator">&gt;</span><span class="token variable">@num2</span><span class="token punctuation">,</span> <span class="token variable">@num1</span><span class="token punctuation">,</span> <span class="token variable">@num2</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> MAYOR<span class="token punctuation">;</span>
<span class="token comment">/*
+-------+
| MAYOR |
+-------+
|    30 |
+-------+
*/</span>

<span class="token comment">/* Mostrar valores teniendo en cuenta varias condiciones */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@temperatura</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-CASE">CASE</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">28</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Calor'</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&lt;</span><span class="token number">28</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Templado'</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Frío'</span>
<span class="token keyword keyword-ELSE">ELSE</span> <span class="token string">'Bajo cero'</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-AS">AS</span> TEMPERATURA<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| TEMPERATURA |
+-------------+
| Calor       |
+-------------+
*/</span>

<span class="token keyword keyword-SET">SET</span> <span class="token variable">@temperatura</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-CASE">CASE</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">28</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Calor'</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&lt;</span><span class="token number">28</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Templado'</span>
<span class="token keyword keyword-WHEN">WHEN</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token variable">@temperatura</span> <span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Frío'</span>
<span class="token keyword keyword-ELSE">ELSE</span> <span class="token string">'Bajo cero'</span>
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-AS">AS</span> TEMPERATURA<span class="token punctuation">;</span>
<span class="token comment">/*
+-------------+
| TEMPERATURA |
+-------------+
| Templado    |
+-------------+
*/</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<p><a href="https://www.w3schools.com/sql/sql_ref_mysql.asp">MySQL – Funciones en MySQL – Web W3SCHOOLS Interactiva</a></p>
</div>
<h2 id="parámetros-de-entrada-salida">Parámetros de Entrada-Salida </h2>
<h3 id="parámetros-de-funciones-y-procedimientos">Parámetros de funciones y procedimientos </h3>
<p>Los parámetros son valores o variables que se pueden pasar a los procedimientos o funciones para que los utilicen en su proceso.</p>
<div class="caso_estudio">
<p>Denominaremos <strong>parámetro-valor</strong>  a la constante que pasamos a un procedimiento o función, es decir, un número, una cadena, una fecha, etc.</p>
<p>En cambio, será <strong>parámetro-variable</strong>  cuando lo que le pasamos al procedimiento o función es una variable.</p>
</div> <!-- fin caso de estudio -->
<p>Por ejemplo, cuando a una función como <strong><code>ROUND</code></strong> le pasamos parámetros, ésta los usa para devolvernos su resultado:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>mysql&gt; SELECT ROUND(34.78, 0);
+-----------------+
| ROUND(34.78, 0) |
+-----------------+
| 35              |
+-----------------+
</code></pre><p>En el ejemplo anterior utilizamos un parámetro-valor  que es 34.78 al llamar a la función <strong><code>ROUND</code></strong>.</p>
<p>En el siguiente ejemplo, realizaremos la misma llamada pero utilizando en uno de los parámetros, un parámetro-variable .</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>mysql&gt; SET @num := 34.78;
mysql&gt; SELECT ROUND(@num, 0);
+----------------+
| ROUND(@num, 0) |
+----------------+
| 35             |
+----------------+
</code></pre><h4 id="tipos-de-parámetros">Tipos de parámetros </h4>
<p>Como hemos visto en el último ejemplo de comparación de cadenas del apartado 3, los procedimientos pueden recibir parámetros y ser utilizados en su propio código como variables internas.</p>
<p>Los parámetros pueden ser de varios tipos:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Tipo</th>
<th style="text-align:left">Significado</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>IN</strong></td>
<td style="text-align:left">De entrada</td>
<td style="text-align:left">Se usa el valor de los parámetros, pero estas variables no transforman su valor después del proceso del procedimiento.</td>
</tr>
<tr>
<td style="text-align:left"><strong>OUT</strong></td>
<td style="text-align:left">De salida</td>
<td style="text-align:left">Se usa la parámetro-variable para asignarle un valor y que lo mantenga una vez terminado el procedimiento.</td>
</tr>
<tr>
<td style="text-align:left"><strong>INOUT</strong></td>
<td style="text-align:left">De entrada y salida</td>
<td style="text-align:left">Cumple los dos casos anteriores, se usa el valor del parámetro-variable y al modificar su valor lo mantiene una vez terminado el procedimiento.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Párametros valor</strong><br>
Procedimiento, de nombre EUROSP, que recibe un número real como parámetro y retorna el valor redondeando a 2 decimales.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> eurosp<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> eurosp<span class="token punctuation">(</span>importe <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>importe<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> EUROS<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token number">25.34</span> <span class="token operator">*</span> <span class="token number">17</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> eurosp<span class="token punctuation">(</span><span class="token number">25.34</span> <span class="token operator">*</span> <span class="token number">17</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>En el ejemplo anterior usamos un parámetro-valor .</p>
<p>En el código de la función observamos que el parámetro importe mantiene su valor.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Párametros</strong><br>
Llamar al procedimiento anterior con un parámetro-variable.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@precio</span> :<span class="token operator">=</span> <span class="token number">25.34</span><span class="token operator">*</span><span class="token number">17</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@precio</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> ud6ejer<span class="token punctuation">.</span>eurosp<span class="token punctuation">(</span><span class="token variable">@precio</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ahora vamos a comprobar qué pasaría si modificamos el valor de un parámetro-valor  dentro del procedimiento.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Párametros valor</strong><br>
Procedimiento que calcula el precio de un artículo al aplicarle un descuento. Recibe como parámetro el precio del artículo y muestra el resultado por pantalla.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> preciodto<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> preciodto<span class="token punctuation">(</span>precio <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dto <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SET">SET</span> precio :<span class="token operator">=</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>precio<span class="token operator">-</span><span class="token punctuation">(</span>precio<span class="token operator">*</span>dto<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> precio <span class="token keyword keyword-AS">AS</span> EUROS<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@artprecio</span> :<span class="token operator">=</span> <span class="token number">112.15</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@artdto</span> :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@artprecio</span><span class="token punctuation">,</span> <span class="token variable">@artdto</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> preciodto<span class="token punctuation">(</span><span class="token variable">@artprecio</span><span class="token punctuation">,</span><span class="token variable">@artdto</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@artprecio</span><span class="token punctuation">,</span> <span class="token variable">@artdto</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Aunque usemos una variable al llamar al procedimiento y modifiquemos su valor en el interior del procedimiento, al salir del procedimiento la variable continúa con su valor inicial. Esto es así porque los parámetros por defecto son de <strong>tipo entrada (IN</strong>).</p>
<p>Veamos qué pasa si lo cambiamos al tipo INOUT:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Párametros variable</strong><br>
El mismo ejemplo que el anterior pero pasando el parámetro precio como de <strong>tipo variable (INOUT)</strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> preciodto<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> preciodto<span class="token punctuation">(</span><span class="token keyword keyword-INOUT">INOUT</span> precio <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dto <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SET">SET</span> precio :<span class="token operator">=</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>precio<span class="token operator">-</span><span class="token punctuation">(</span>precio<span class="token operator">*</span>dto<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> precio <span class="token keyword keyword-AS">AS</span> EUROS<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@artprecio</span> :<span class="token operator">=</span> <span class="token number">112.15</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@artdto</span> :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@artprecio</span><span class="token punctuation">,</span> <span class="token variable">@artdto</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> preciodto<span class="token punctuation">(</span><span class="token variable">@artprecio</span><span class="token punctuation">,</span><span class="token variable">@artdto</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@artprecio</span><span class="token punctuation">,</span> <span class="token variable">@artdto</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ahora al llamar al procedimiento y modificar el<br>
valor de la variable en el interior del procedimiento, resulta que la variable tiene el valor que se le ha asignado dentro del procedimiento. En el ejemplo, la variable <em>@artprecio</em> ha cambiado su valor.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Párametros IN</strong><br>
Comprueba el valor de la variable <em>num</em> después de utilizarse en el procedimiento como parámetro de <strong>tipo IN</strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> variableIN<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> variableIN<span class="token punctuation">(</span><span class="token operator">IN</span> num <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SET">SET</span> num <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> num<span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> num <span class="token keyword keyword-AS">AS</span> DENTRO_IN<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> variableIN<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@num</span> <span class="token keyword keyword-AS">AS</span> FUERA_IN<span class="token punctuation">;</span>
</code></pre><p>La ejecución del código muestra <strong>@num</strong> vale 2 después de la llamada al procedimiento y por lo tanto conserva su valor original aunque se halla modificado en el procedimiento.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Párametros OUT</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> variableOUT<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> variableOUT<span class="token punctuation">(</span><span class="token keyword keyword-OUT">OUT</span> num <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SET">SET</span> num <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> num<span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> num <span class="token keyword keyword-AS">AS</span> DENTRO_OUT<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> variableOUT<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@num</span> <span class="token keyword keyword-AS">AS</span> FUERA_OUT<span class="token punctuation">;</span>
</code></pre><p>La ejecución del código muestra que <strong>@num</strong> vale <em><strong>NULL</strong></em> después de la llamada al procedimiento.<br>
Los parámetros de sálida pierden su valor, si tenían alguno, antes de ejecutarse la instrucciones del procedimiento, por lo tanto asignarle a <strong>@num</strong> la multiplicación por 2 da como resulta <em><strong>NULL</strong></em> puesto que <strong>@num</strong> es <em><strong>NULL</strong></em>.<br>
Además como el tipo de parámetro es OUT el valor asignado dentro del procedimiento es el valor que tendrá la variable cuando se acabe la ejecución del procedimiento. el procedimiento.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p>Comprueba el valor de la variable num después de utilizarse en el procedimiento como parámetro de <strong>tipo INOUT</strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> ud6er<span class="token punctuation">.</span>variableINOUT<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> variableINOUT<span class="token punctuation">(</span><span class="token keyword keyword-INOUT">INOUT</span> num <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
<span class="token keyword keyword-SET">SET</span> num <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> num<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> num <span class="token keyword keyword-AS">AS</span> DENTRO_INOUT<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@num</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword keyword-CALL">CALL</span> variableINOUT<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@num</span> <span class="token keyword keyword-AS">AS</span> FUERA_INOUT<span class="token punctuation">;</span>
</code></pre><p>La ejecución del código muestra que <strong>@num</strong> vale 10 después de la llamada al procedimiento.<br>
Por lo tanto la modificación de la variable <strong>@num</strong> que se ha producido dentro del procedimiento ha persistido cuando este ha acabado.</p>
</div>
<h2 id="funciones-definidas-por-el-usuario">Funciones definidas por el usuario </h2>
<div class="caso_estudio">
<p>Las <strong>funciones</strong> se diferencian de los procedimientos en que nos permiten devolver un valor. Todos los parámetros de una función son de entrada y no es necesario indicar IN a los parámetros.</p>
<p>Las <strong>funciones definidas por el usuario</strong> (User Defined Functions – UDF) funcionan como las predefinidas de MySQL pero las creamos con almacenamiento de programas (Stored Programs).</p>
<p>Para crear una UDF usaremos la sintaxis:<br>
<b></b></p><b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> nombrefuncion<span class="token punctuation">(</span><span class="token punctuation">[</span>parámetros<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword keyword-RETURNS">RETURNS</span> {<span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token operator">|</span><span class="token keyword keyword-INT">INT</span><span class="token operator">|</span><span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token operator">|</span><span class="token keyword keyword-DATE">DATE</span><span class="token operator">|</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>}
</code></pre></b>
</div> <!-- fin caso de estudio -->
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Funciones definidas por el usuario</strong><br>
Función que recibe una cadena y devuelve la primera letra.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> primeraletra<span class="token punctuation">;</span>
<span class="token comment">/* Crear la función */</span>

<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> primeraletra<span class="token punctuation">(</span>cadena <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> cadresul <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> cadresul :<span class="token operator">=</span> <span class="token keyword keyword-LEFT">LEFT</span><span class="token punctuation">(</span>cadena<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> cadresul<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@cad</span> <span class="token operator">=</span> <span class="token string">'Prueba de una función'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@resul</span> <span class="token operator">=</span> primeraletra<span class="token punctuation">(</span><span class="token variable">@cad</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@resul</span><span class="token punctuation">;</span>
</code></pre></div>
<blockquote>
<p>📌 En la versión MySQL 8.0, existe una variable global de sistema que puede impedir la creación de funciones. Si recibimos el error:</p>
<p><em>This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you might  want to use the less safe log_bin_trust_function_creators variable)</em></p>
<p>deberemos cambiar la configuraració de MySQL Server. Para ello editaremos el archivo:<br>
<strong>C:\ProgramData\MySQL\MySQL Server 8.0\my.ini</strong><br>
y  añadiremos bajo la sección [<code>mysqld</code>] la línea siguiente:<br>
<strong>log_bin_trust_function_creators= 1</strong></p>
<p>Después de grabar tendremos que reiniciar el servicio de MySQL 8.0 y podremos comprobar que ya funciona correctamente.</p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Funciones definidas por el usuario</strong><br>
Función que recibe un número entero y devuelve el siguiente entero.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> signum<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> signum<span class="token punctuation">(</span>num <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> intresul <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> intresul :<span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> intresul<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@numero</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> signum<span class="token punctuation">(</span><span class="token variable">@numero</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> signum<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Podemos hacer la función anterior con variables de usuario globales en vez de variables de función:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Funciones definidas por el usuario</strong><br>
Función que recibe un número entero y devuelve el siguiente entero.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> signum<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> signum<span class="token punctuation">(</span>num <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-SET">SET</span> <span class="token variable">@intresul</span> :<span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> <span class="token variable">@intresul</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SELECT">SELECT</span> signum<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@intresul</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Podemos observar que la variable se ha creado y es global porque mantiene su valor fuera de la función.</p>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>Usar variables globales dentro de una función o procedimiento generalmente no se suele utilizar para no dejar valores en memoria y para no interferir en el resultado de diferentes llamadas a la función de forma simultánea.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Funciones definidas por el usuario</strong><br>
Función que no recibe ningún parámetro y devuelve el día siguiente al actual.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> tomorrow<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> tomorrow<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-DATE">DATE</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> fecha <span class="token keyword keyword-DATE">DATE</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> fecha :<span class="token operator">=</span> ADDDATE<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> fecha<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SELECT">SELECT</span> tomorrow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="procedimientos-y-funciones-con-acceso-a-datos">Procedimientos y funciones con acceso a datos </h2>
<h3 id="acceso-a-datos">Acceso a datos </h3>
<p>Los procedimientos y funciones suelen acceder a las bases de datos para procesar información. En muchas ocasiones nos permiten generar campos calculados.</p>
<p>Veamos unos ejemplos con la BD de <em>World</em> y algunas funciones predefinidas de control.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Funciones predefinidas con acceso a datos</strong><br>
Obtener los países con un campo calculado adicional denominado <strong>GNPInteranual</strong> en las que indicaremos <em>Crecimiento</em> si ha aumentado el <strong><code>GNP</code></strong> y <em>Decrecimiento</em> en otro caso. (<strong><code>code</code></strong>, <strong><code>name</code></strong>, <strong><code>GNP</code></strong>, <strong><code>GNPOld</code></strong>, <strong><code>GNPInteranual</code></strong>).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> code<span class="token punctuation">,</span> name<span class="token punctuation">,</span> GNP<span class="token punctuation">,</span> GNPOld<span class="token punctuation">,</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">(</span>GNP <span class="token operator">&gt;</span> GNPOld<span class="token punctuation">,</span><span class="token string">'Crecimiento'</span><span class="token punctuation">,</span> <span class="token string">'Decrecimiento'</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> <span class="token string">'GNPInteranual'</span>
<span class="token keyword keyword-FROM">FROM</span> country
<span class="token keyword keyword-WHERE">WHERE</span> <span class="token punctuation">(</span>GNP <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>GNPOld <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Funciones predefinidas con acceso a datos</strong><br>
Obtener los países con el nombre del continente al que pertenecen pero traducido (<strong><code>code</code></strong>, <strong><code>name</code></strong>, <strong><code>continent</code></strong>).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> code<span class="token punctuation">,</span> name<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token keyword keyword-CASE">CASE</span> continent
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'Africa'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'África'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'Antarctica'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Antártida'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'Asia'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Asia'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'Europe'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Europa'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'North America'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Norteamérica'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'Oceania'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Oceanía'</span>
        <span class="token keyword keyword-WHEN">WHEN</span> <span class="token string">'South America'</span> <span class="token keyword keyword-THEN">THEN</span> <span class="token string">'Sudamérica'</span>
        <span class="token keyword keyword-ELSE">ELSE</span> <span class="token string">'n/a'</span>
    <span class="token keyword keyword-END">END</span><span class="token punctuation">)</span>
<span class="token keyword keyword-AS">AS</span> <span class="token string">'Continente'</span>
<span class="token keyword keyword-FROM">FROM</span> country<span class="token punctuation">;</span>
</code></pre></div>
<p>También hay casos en que las funciones nos permiten realizar procesos de selección, es decir, usarlas en las condiciones de la cláusula <strong><code>WHERE</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Funciones predefinidas con acceso a datos</strong><br>
Obtener los países en los que coincide que el campo <strong><code>code2</code></strong> son las dos primeras letras del campo <strong><code>code</code></strong>. Mostrar <strong><code>code</code></strong>, <strong><code>name</code></strong> y <strong><code>code2</code></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> code<span class="token punctuation">,</span> code2<span class="token punctuation">,</span> name 
<span class="token keyword keyword-FROM">FROM</span> country 
<span class="token keyword keyword-WHERE">WHERE</span> <span class="token keyword keyword-LEFT">LEFT</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> code2<span class="token punctuation">;</span>
</code></pre></div>
<h3 id="acceso-a-datos-desde-funciones-definidas-por-el-usuario">Acceso a datos desde funciones definidas por el usuario </h3>
<p>Nuestro objetivo principal será desarrollar funciones que procesen datos contenidos en los campos de las tablas y devuelvan valores.</p>
<p>Veamos algunos ejemplos también con la BD <em>World</em>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Procedimientos y funciones con acceso a datos</strong><br>
Realizar una función denominada <strong>CUENTACIUDADES</strong> que reciba como parámetro el código de un país y devuelva el número de ciudades que hay en la BD.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> CUENTACIUDADES<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> CUENTACIUDADES<span class="token punctuation">(</span>pCodePais <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> intCiudades <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-INTO">INTO</span> intCiudades <span class="token keyword keyword-FROM">FROM</span> city <span class="token keyword keyword-WHERE">WHERE</span> CountryCode <span class="token operator">=</span> pCodePais<span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> intCiudades<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función: retorna la cantida de ciudades que hau en Argentiba. */</span>
<span class="token keyword keyword-SELECT">SELECT</span> CUENTACIUDADES<span class="token punctuation">(</span><span class="token string">'ARG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+-----------------------+
| CUENTACIUDADES('ARG') |
+-----------------------+
|                    57 |
+-----------------------+
*/</span>

<span class="token comment">/* Llamar a la función: retorna la cantidad de ciudades de cada país */</span>
<span class="token keyword keyword-SELECT">SELECT</span> code<span class="token punctuation">,</span> name<span class="token punctuation">,</span> CUENTACIUDADES<span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> numciudades <span class="token keyword keyword-FROM">FROM</span> country<span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Procedimientos y funciones con acceso a datos</strong><br>
Realizar una función denominada <strong>NOMBRECIUDAD</strong> que reciba como parámetro el ID de una ciudad y devuelva su nombre. La función nunca debe devolver <strong><code>NULL</code></strong>, pues en este caso devolverá ''.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> NOMBRECIUDAD<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> NOMBRECIUDAD<span class="token punctuation">(</span>pIdCiudad <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> nCiudad <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SELECT">SELECT</span> name <span class="token keyword keyword-INTO">INTO</span> nCiudad <span class="token keyword keyword-FROM">FROM</span> city <span class="token keyword keyword-WHERE">WHERE</span> ID <span class="token operator">=</span> pIdCiudad<span class="token punctuation">;</span>
    <span class="token keyword keyword-IF">IF</span> nCiudad <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-THEN">THEN</span> 
        <span class="token keyword keyword-SET">SET</span> nCiudad <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> nCiudad<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función: retorna Albacete por que 390 es el código de Albacete */</span>
<span class="token keyword keyword-SELECT">SELECT</span> NOMBRECIUDAD<span class="token punctuation">(</span><span class="token number">390</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+-------------------+
| NOMBRECIUDAD(390) |
+-------------------+
| Albacete          |
+-------------------+
*/</span>

<span class="token comment">/* Llamar a la función: retorna el código y el nombre de la capital de cada país */</span>
<span class="token keyword keyword-SELECT">SELECT</span> code<span class="token punctuation">,</span> name<span class="token punctuation">,</span> NOMBRECIUDAD<span class="token punctuation">(</span>capital<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> NombreCapital <span class="token keyword keyword-FROM">FROM</span> country<span class="token punctuation">;</span>
</code></pre></div>
<h3 id="control-de-errores">Control de errores </h3>
<p>En muchos casos las funciones que definimos generan errores, como el que se produce al insertar un registro por incumplir restricciones.</p>
<p>Para ver un ejemplo crearemos una función para insertar ciudades en la tabla <strong>city</strong> de la BD <em>World</em>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 6</p>
<p><strong>Procedimientos y funciones con acceso a datos</strong><br>
Realizar una función denominada <strong>INSERTACIUDAD</strong> que reciba como parámetros el (<strong><code>Name</code></strong>, <strong><code>CountryCode</code></strong>, <strong><code>District</code></strong>,  <strong><code>Population</code></strong>) de una ciudad y la inserte como un nuevo registro en la tabla city de la BD World. El ID no es necesario porque está declarado como <strong><code>AUTO_INCREMENT</code></strong>. La función devolverá el ID asignado en el <strong><code>INSERT</code></strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> INSERTACIUDAD<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> INSERTACIUDAD<span class="token punctuation">(</span>pName <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pCountryCode <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pDistrict <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pPopulation <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> resul <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> city<span class="token punctuation">(</span>Name<span class="token punctuation">,</span> CountryCode<span class="token punctuation">,</span> District<span class="token punctuation">,</span> Population<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span>pName<span class="token punctuation">,</span> pCountryCode<span class="token punctuation">,</span> pDistrict<span class="token punctuation">,</span> pPopulation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> resul <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> resul<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SELECT">SELECT</span> INSERTACIUDAD<span class="token punctuation">(</span><span class="token string">'Elche'</span><span class="token punctuation">,</span><span class="token string">'ESP'</span><span class="token punctuation">,</span><span class="token string">'Valencia'</span><span class="token punctuation">,</span><span class="token number">227659</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
+------------------------------------------------+
| INSERTACIUDAD('Elche','ESP','Valencia',227659) |
+------------------------------------------------+
|                                           4080 |
+------------------------------------------------+
*/</span>
</code></pre></div>
<p>La ejecución del ejemplo anterior inserta correctamente la ciudad de <em>Elche</em>. ¿Pero qué pasaría si indicamos un código de país que no existe?</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SELECT">SELECT</span> INSERTACIUDAD<span class="token punctuation">(</span><span class="token string">'Elche'</span><span class="token punctuation">,</span><span class="token string">'XXX'</span><span class="token punctuation">,</span><span class="token string">'Valencia'</span><span class="token punctuation">,</span><span class="token number">227659</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="text" class="language-text text"><code>Error Consulta SQL:
SELECT INSERTACIUDAD('Elche','XXX','Valencia',227659)

MySQL ha dicho: Documentación
#1452 - Cannot add or update a child row: a foreign key constraint fails (`world`.`city`, CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `country` (`Code`))
</code></pre><p>Como hemos podido observar, cuando se producen errores, perdemos el control del proceso. MySQL permite manejar y controlar los errores mediante el uso de gestor o manejador de errores (<strong>HANDLER</strong>).</p>
<div class="caso_estudio">
<b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DECLARE">DECLARE</span> <span class="token keyword keyword-EXIT">EXIT</span> <span class="token keyword keyword-HANDLER">HANDLER</span> <span class="token keyword keyword-FOR">FOR</span> SQLEXCEPTION
<span class="token keyword keyword-BEGIN">BEGIN</span> 
    <span class="token punctuation">[</span>instrucciones<span class="token punctuation">]</span>
<span class="token keyword keyword-END">END</span><span class="token punctuation">;</span>
</code></pre></b>
</div> <!-- fin caso de estudio -->
<p>Cuando se produce un error, MySQL nos indica un código de error (<em>error code</em>) y un mensaje. Todos estos códigos están en la documentación oficial.<br>
Con un manejador de errores hacemos que en caso de error el programa no aborte si no que se pase el control al manejador y se ejecuten las instrucciones que tiene definidas.</p>
<div class="admonition note">
<p class="admonition-title">Referencias</p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/declare-handlerhtml">MySQL Oficial – Control de Errores en MySQL – Web Oficial en inglés</a><br>
<a href="https:/dev.mysql.com/doc/refman/5.5/en/error-messages-server.html">MySQL Oficial – Errores en MySQL – Web Oficial en inglés</a></p>
</div>
<h3 id="comprobar-los-errores">Comprobar los errores </h3>
<p>Cuando se produce un error en una instrucción SQL, obtendremos un error o warning que se almacenará en la BD de control de errores. Este error podemos consultarlo con la instrucción <strong><code>SHOW WARNINGS</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 7</p>
<p><strong>Control de errores</strong><br>
Eliminar una tabla que no existe y comprobar cual es el error.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Intentamos eliminar una tabla que no existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TABLE">TABLE</span> mitabla<span class="token punctuation">;</span>
ERROR <span class="token number">1051</span> <span class="token punctuation">(</span><span class="token number">42</span>S02<span class="token punctuation">)</span>: Tabla <span class="token string">'world.mitabla'</span> desconocida

<span class="token keyword keyword-SHOW">SHOW</span> <span class="token keyword keyword-WARNINGS">WARNINGS</span><span class="token punctuation">;</span>
<span class="token comment">/*
+-------+------+-----------------------------------+
| Level | Code | Message                           |
+-------+------+-----------------------------------+
| Error | 1051 | Tabla 'world.mitabla' desconocida |
+-------+------+-----------------------------------+
*/</span>
</code></pre></div>
<p>Si deseamos almacenar el código y el mensaje en variables propias usaremos la instrucción <strong><code>GET DIAGNOSTICS</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 8</p>
<p><strong>Control de errores</strong><br>
Eliminar una tabla que no existe y comprobar cual es el error.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TABLE">TABLE</span> mitabla<span class="token punctuation">;</span> 
ERROR <span class="token number">1051</span> <span class="token punctuation">(</span><span class="token number">42</span>S02<span class="token punctuation">)</span>: Tabla <span class="token string">'world.mitabla'</span> desconocida

GET DIAGNOSTICS CONDITION <span class="token number">1</span> <span class="token variable">@errcode</span> <span class="token operator">=</span> RETURNED_SQLSTATE<span class="token punctuation">,</span> <span class="token variable">@errmsg</span> <span class="token operator">=</span> MESSAGE_TEXT<span class="token punctuation">;</span>

<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@errcode</span><span class="token punctuation">,</span> <span class="token variable">@errmsg</span><span class="token punctuation">;</span>
<span class="token comment">/*
+----------+-----------------------------------+
| @errcode | @errmsg                           |
+----------+-----------------------------------+
| 42S02    | Tabla 'world.mitabla' desconocida |
+----------+-----------------------------------+
*/</span>
</code></pre></div>
<p>Vamos a modificar la función <strong>INSERTACIUDAD</strong> para que controle errores de inserción. La función nos devuelve el ID de la ciudad insertada, pero en caso de error deberá devolver el valor -1.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 9</p>
<p><strong>Control de errores</strong><br>
Realizar una función denominada <strong>INSERTACIUDAD</strong> que reciba como parámetros el (<strong><code>Name</code></strong>, <strong><code>CountryCode</code></strong>, <strong><code>District</code></strong>, <strong><code>Population</code></strong>) de una ciudad y la inserte como un nuevo registro en la tabla <strong>city</strong> de la BD <em><strong>World</strong></em>. El ID no es necesario porque está declarado como <strong><code>AUTO_INCREMENT</code></strong>. La función devolverá el ID asignado en el <strong><code>INSERT</code></strong>. En caso de error devolverá el valor -1.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> INSERTACIUDAD<span class="token punctuation">;</span>

<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> INSERTACIUDAD<span class="token punctuation">(</span>pName <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pCountryCode <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pDistrict <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pPopulation <span class="token keyword keyword-INT">INT</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> resul <span class="token keyword keyword-INT">INT</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-DECLARE">DECLARE</span> <span class="token keyword keyword-EXIT">EXIT</span> <span class="token keyword keyword-HANDLER">HANDLER</span> <span class="token keyword keyword-FOR">FOR</span> SQLEXCEPTION 
    <span class="token keyword keyword-BEGIN">BEGIN</span> 
        <span class="token keyword keyword-SET">SET</span> resul <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
        <span class="token keyword keyword-RETURN">RETURN</span> resul<span class="token punctuation">;</span> 
    <span class="token keyword keyword-END">END</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> city<span class="token punctuation">(</span>Name<span class="token punctuation">,</span> CountryCode<span class="token punctuation">,</span> District<span class="token punctuation">,</span> Population<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span>pName<span class="token punctuation">,</span> pCountryCode<span class="token punctuation">,</span> pDistrict<span class="token punctuation">,</span> pPopulation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> resul <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-RETURN">RETURN</span> resul<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar a la función */</span>
<span class="token keyword keyword-SELECT">SELECT</span> INSERTACIUDAD<span class="token punctuation">(</span><span class="token string">'Elche'</span><span class="token punctuation">,</span><span class="token string">'XXX'</span><span class="token punctuation">,</span><span class="token string">'Valencia'</span><span class="token punctuation">,</span><span class="token number">227659</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Si deseamos realizar un <strong><code>PROCEDURE</code></strong> donde recojamos el error y mensaje que se haya producido, deberemos usar parámetros-variables de tipo <strong><code>OUT</code></strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 10</p>
<p><strong>Control de errores</strong><br>
Realizar un procedimiento denominado <strong>PROC_INSERTACIUDAD</strong> que reciba como parámetros el (<strong><code>Name</code></strong>, <strong><code>CountryCode</code></strong>, <strong><code>District</code></strong>, <strong><code>Population</code></strong>) de una ciudad y la inserte como un nuevo registro en la tabla <strong>city</strong> de la BD <em><strong>World</strong></em>. El ID no es necesario porque está declarado como <strong><code>AUTO_INCREMENT</code></strong>. El procedimiento recibirá tres parámetros más para recoger:</p>
<ul>
<li><strong>idCiudad</strong> → ID de la ciudad asignado en el <code>INSERT</code></li>
<li><strong>errcode</strong> → Código de error</li>
<li><strong>errmsg</strong> → Mensaje de error</li>
</ul>
<p>En caso de error devolverá <strong>idCiudad</strong> tendrá el valor -1. En caso de no haber error, errcode valdrá '00000' y errmsg será ''.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el procedimiento si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> PROC_INSERTACIUDAD<span class="token punctuation">;</span>

<span class="token comment">/* Crear el procedimiento */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-PROCEDURE">PROCEDURE</span> PROC_INSERTACIUDAD<span class="token punctuation">(</span>
    pName <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    pCountryCode <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    pDistrict <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    pPopulation <span class="token keyword keyword-INT">INT</span><span class="token punctuation">,</span> 
    <span class="token keyword keyword-OUT">OUT</span> idCiudad <span class="token keyword keyword-INT">INT</span><span class="token punctuation">,</span> 
    <span class="token keyword keyword-OUT">OUT</span> errcode <span class="token keyword keyword-varchar">varchar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword keyword-OUT">OUT</span> errmsg <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> <span class="token keyword keyword-EXIT">EXIT</span> <span class="token keyword keyword-HANDLER">HANDLER</span> <span class="token keyword keyword-FOR">FOR</span> SQLEXCEPTION 
    <span class="token keyword keyword-BEGIN">BEGIN</span> 
        GET DIAGNOSTICS CONDITION <span class="token number">1</span> errcode <span class="token operator">=</span> RETURNED_SQLSTATE<span class="token punctuation">,</span> errmsg <span class="token operator">=</span> MESSAGE_TEXT<span class="token punctuation">;</span> 
        <span class="token keyword keyword-SET">SET</span> idCiudad <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-END">END</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-SET">SET</span> errcode <span class="token operator">=</span> <span class="token string">'00000'</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-SET">SET</span> errmsg <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> city<span class="token punctuation">(</span>Name<span class="token punctuation">,</span> CountryCode<span class="token punctuation">,</span> District<span class="token punctuation">,</span> Population<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span>pName<span class="token punctuation">,</span> pCountryCode<span class="token punctuation">,</span> pDistrict<span class="token punctuation">,</span> pPopulation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-SET">SET</span> idCiudad <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Llamar al procedimiento */</span>
<span class="token keyword keyword-CALL">CALL</span> PROC_INSERTACIUDAD<span class="token punctuation">(</span><span class="token string">'Elche'</span><span class="token punctuation">,</span> <span class="token string">'ESP'</span><span class="token punctuation">,</span> <span class="token string">'Valencia'</span><span class="token punctuation">,</span> <span class="token number">227659</span><span class="token punctuation">,</span> <span class="token variable">@vID</span><span class="token punctuation">,</span> <span class="token variable">@vError</span><span class="token punctuation">,</span> <span class="token variable">@vErrMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token variable">@vID</span><span class="token punctuation">,</span> <span class="token variable">@vError</span><span class="token punctuation">,</span> <span class="token variable">@vErrMsg</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Realizar el proyecto <strong>bancaria 1 (repaso de UD3 y UD5) y bancaria 2 (con procedimientos)</strong>.</p>
<h2 id="disparadores">Disparadores </h2>
<div class="caso_estudio">
<p>Los <strong>disparadores</strong> o <strong>triggers</strong> son procedimientos especiales que se ejecutan cuando se produce un evento o acción sobre una tabla de la BD.</p>
<p>Los disparadores o triggers no devuelven valores como una función, ni muestran resultados con <strong><code>SELECT</code></strong>.</p>
</div> <!-- fin caso de estudio -->
<p>Para definir un disparador debemos indicar:</p>
<ul>
<li><strong>evento</strong>: acción que desencadena el disparador (<strong><code>INSERT</code></strong>, <strong><code>UPDATE</code></strong> o <strong><code>DELETE</code></strong>)</li>
<li><strong>tiempo</strong>: antes o después del evento (<strong><code>AFTER</code></strong> o <strong><code>BEFORE</code></strong>)</li>
<li><strong>tabla</strong>: indica en qué tabla se produce el evento</li>
</ul>
<p>Veamos algunos ejemplos de uso:</p>
<ul>
<li><strong>Realizar acciones derivadas del evento</strong> pues podemos realizar otras instrucciones <strong><code>INSERT</code></strong>, <strong><code>UPDATE</code></strong> o <strong><code>DELETE</code></strong> relacionadas.</li>
<li><strong>Para modificar los valores recibidos y grabarlos correctamente</strong> en instrucciones <strong><code>INSERT</code></strong> o <strong><code>UPDATE</code></strong>.</li>
<li><strong>Para crear los valores de campos calculados</strong> en instrucciones <strong><code>INSERT</code></strong> o <strong><code>UPDATE</code></strong>.</li>
<li><strong>Para checkear valores correcto</strong>s y generar un mensaje en caso de error.</li>
</ul>
<p>Los valores recibidos en las instrucciones de los disparadores son <strong><code>NEW.nombrecampo</code></strong> y <strong><code>OLD.nombrecampo</code></strong>. Dependiendo del tipo de evento podremos usar:</p>
<ul>
<li>En <strong><code>UPDATE</code></strong>: <strong><code>NEW.nombrecampo</code></strong> para los nuevos valores y <strong><code>OLD.nombrecampo</code></strong> para los antiguos.</li>
<li>En <strong><code>INSERT</code></strong>: <strong><code>NEW.nombrecampo</code></strong> pues no tenemos antiguos.</li>
<li>En <strong><code>DELETE</code></strong>: <strong><code>OLD.nombrecampo</code></strong> pues no tenemos nuevos.</li>
</ul>
<p>Para los siguientes ejercicios, crearemos una BD denominada <em><strong>bancaria3</strong></em> con las tablas <strong>clientes</strong> y <strong>movimientos</strong> descritas anteriormente y añadiremos una tabla llamada <strong>logdisparadores</strong> para insertar los valores de los registros procesados con los siguientes campos:</p>
<ul>
<li><strong><code>id_reg</code></strong>: número entero (<code>INT</code>), sin signo (<code>UNSIGNED</code>) y rellenado aceros por la izquierda, clave primaria y valor automático (<code>AUTO_INCREMENT</code>)</li>
<li><strong><code>tabla</code></strong>: cadena de 50 carácteres de longitud máxima (<code>VARCHAR(50)</code>)</li>
<li><strong><code>evento</code></strong>: cadena de 20 carácteres de longitud máxima (<code>VARCHAR(20)</code>)</li>
<li><strong><code>tiempo</code></strong>: cadena de 20 carácteres de longitud máxima (<code>VARCHAR(20)</code>)</li>
<li><strong><code>fechayhora</code></strong>: campo que almacene la fecha y hora de ejecución (<code>DATETIME</code>)</li>
<li><strong><code>valores</code></strong>: cadena de 250 carácteres de longitud máxima (<code>VARCHAR(250)</code>) para almacenar todos los valores del registro de clientes eliminado. Utilizaremos el carácter <strong>|</strong> entre los diferentes campos como separador.</li>
</ul>
<p><em><strong>Creación de la Base de Datos y Tablas</strong></em></p>
<div class="caso_estudio">
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Crear base de datos y seleccionarla */</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-DATABASE">DATABASE</span> <span class="token keyword keyword-IF">IF</span> <span class="token operator">NOT</span> <span class="token keyword keyword-EXISTS">EXISTS</span> bancaria3 <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token keyword keyword-CHARACTER">CHARACTER</span> <span class="token keyword keyword-SET">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-USE">USE</span> bancaria3<span class="token punctuation">;</span>

<span class="token comment">/* Crear tablas*/</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TABLE">TABLE</span> clientes<span class="token punctuation">(</span>
    dni <span class="token keyword keyword-INT">INT</span> <span class="token keyword keyword-PRIMARY">PRIMARY</span> <span class="token keyword keyword-KEY">KEY</span><span class="token punctuation">,</span> 
    nombre <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword keyword-UNIQUE">UNIQUE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
    saldo <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token number">0</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TABLE">TABLE</span> movimientos<span class="token punctuation">(</span>
    id_mov <span class="token keyword keyword-INT">INT</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword keyword-UNSIGNED">UNSIGNED</span> ZEROFILL <span class="token keyword keyword-AUTO_INCREMENT">AUTO_INCREMENT</span> <span class="token keyword keyword-PRIMARY">PRIMARY</span> <span class="token keyword keyword-KEY">KEY</span><span class="token punctuation">,</span>
    dni <span class="token keyword keyword-INT">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
    concepto <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
    importe <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-FOREIGN">FOREIGN</span> <span class="token keyword keyword-KEY">KEY</span><span class="token punctuation">(</span>dni<span class="token punctuation">)</span> <span class="token keyword keyword-REFERENCES">REFERENCES</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TABLE">TABLE</span> logdisparadores<span class="token punctuation">(</span>
    id_reg <span class="token keyword keyword-INT">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-UNSIGNED">UNSIGNED</span> ZEROFILL <span class="token keyword keyword-PRIMARY">PRIMARY</span> <span class="token keyword keyword-KEY">KEY</span> <span class="token keyword keyword-AUTO_INCREMENT">AUTO_INCREMENT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    tabla <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    evento <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    tiempo <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    fechayhora <span class="token keyword keyword-DATETIME">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    valores <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<h3 id="triggers-que-realizan-acciones-derivadas-del-evento">Triggers que realizan acciones derivadas del evento </h3>
<p>En los 3 ejemplos siguientes vamos a utilizar la tabla <strong>logdisparadores</strong> como un registro de contabilidad (log) de las operaciones de actualización realizadas sobre la tabla <strong>clientes</strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Triggers</strong><br>
Deseamos que si un usuario inserta un registro en la tabla <strong>clientes</strong>, guardemos un LOG en la tabla <strong>logdisparadores</strong> con los valores insertados. Para ello, en la BD <em><strong>bancaria3</strong></em>, tenemos que crear un disparador para la tabla <strong>clientes</strong> que tenga en cuenta:</p>
<ul>
<li><strong>tiempo</strong>: después (<strong><code>AFTER</code></strong>)</li>
<li><strong>evento</strong>: insertar (<strong><code>INSERT</code></strong>)</li>
<li><strong>tabla</strong>: clientes</li>
<li><strong>acción</strong>: guardar un LOG con los datos insertados</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> clientes_after_insert<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> clientes_after_insert
<span class="token keyword keyword-AFTER">AFTER</span> <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-ON">ON</span> clientes
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Insertar valores nuevos */</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> logdisparadores <span class="token punctuation">(</span>tabla<span class="token punctuation">,</span> evento<span class="token punctuation">,</span> tiempo<span class="token punctuation">,</span> fechayhora<span class="token punctuation">,</span> valores<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CLIENTES'</span><span class="token punctuation">,</span> <span class="token string">'INSERT'</span><span class="token punctuation">,</span> <span class="token string">'AFTER'</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'VALORES NUEVOS|'</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>dni<span class="token punctuation">,</span><span class="token string">'|'</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>nombre<span class="token punctuation">,</span> <span class="token string">'|'</span> <span class="token punctuation">,</span>NEW<span class="token punctuation">.</span>saldo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Cargar datos y forzar a que se ejecute el disparador*/</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21456456'</span><span class="token punctuation">,</span> <span class="token string">'María González'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21456457'</span><span class="token punctuation">,</span> <span class="token string">'Mario González'</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> logdisparadores<span class="token punctuation">;</span>
</code></pre><p>El trigger se ejecuta dos veces puesto que se hacen dos inserciones en la tabla clientes.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 2</p>
<p><strong>Triggers</strong><br>
Deseamos que si un usuario elimina un registro de la tabla <strong>clientes</strong>, guardemos un LOG en la tabla <strong>logdisparadores</strong> con los valores eliminados. Para ello, en la BD <em><strong>bancaria3</strong></em>, tenemos que crear un disparador para la tabla <strong>clientes</strong> que tenga en cuenta:</p>
<ul>
<li><strong>tiempo</strong>: después (<strong><code>AFTER</code></strong>)</li>
<li><strong>evento</strong>: borrar (<strong><code>DELETE</code></strong>)</li>
<li><strong>tabla</strong>: clientes</li>
<li><strong>acción</strong>: guardar un LOG con los datos eliminados</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> clientes_after_delete<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> clientes_after_delete
<span class="token keyword keyword-AFTER">AFTER</span> <span class="token keyword keyword-DELETE">DELETE</span> <span class="token keyword keyword-ON">ON</span> clientes
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Insertar valores nuevos */</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> logdisparadores <span class="token punctuation">(</span>tabla<span class="token punctuation">,</span> evento<span class="token punctuation">,</span> tiempo<span class="token punctuation">,</span> fechayhora<span class="token punctuation">,</span> valores<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CLIENTES'</span><span class="token punctuation">,</span><span class="token string">'DELETE'</span><span class="token punctuation">,</span><span class="token string">'AFTER'</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'VALORES ANTIGUOS|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>dni<span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>nombre<span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>saldo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Forzar a que se ejecute el disparador */</span>
<span class="token keyword keyword-DELETE">DELETE</span> <span class="token keyword keyword-FROM">FROM</span> clientes <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21456456'</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> logdisparadores<span class="token punctuation">;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo 3</p>
<p><strong>Triggers</strong><br>
Deseamos que si un usuario modifica un registro de la tabla <strong>clientes</strong>, guardemos un LOG en la tabla <strong>logdisparadores</strong> con los valores anteriores a la modificación y con los nuevos. Para ello, en la BD <em><strong>bancaria3</strong></em>, tenemos que crear un disparador para la tabla <strong>clientes</strong> que tenga en cuenta:</p>
<ul>
<li><strong>tiempo</strong>: después (<strong><code>AFTER</code></strong>)</li>
<li><strong>evento</strong>: modificar (<strong><code>UPDATE</code></strong>)</li>
<li><strong>tabla</strong>: <strong><code>clientes</code></strong></li>
<li><strong>acción</strong>: guardar un LOG con los datos modificados</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> clientes_after_update<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> clientes_after_update
<span class="token keyword keyword-AFTER">AFTER</span> <span class="token keyword keyword-UPDATE">UPDATE</span> <span class="token keyword keyword-ON">ON</span> clientes
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Insertar valores antiguos */</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> logdisparadores <span class="token punctuation">(</span>tabla<span class="token punctuation">,</span> evento<span class="token punctuation">,</span> tiempo<span class="token punctuation">,</span> fechayhora<span class="token punctuation">,</span> valores<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CLIENTES'</span><span class="token punctuation">,</span> <span class="token string">'AFTER'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE'</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'VALORES ANTIGUOS|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>dni<span class="token punctuation">,</span><span class="token string">'|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>nombre<span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>saldo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Insertar valores nuevos */</span>
    <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> logdisparadores <span class="token punctuation">(</span>tabla<span class="token punctuation">,</span> evento<span class="token punctuation">,</span> tiempo<span class="token punctuation">,</span> fechayhora<span class="token punctuation">,</span> valores<span class="token punctuation">)</span> 
    <span class="token keyword keyword-VALUES">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CLIENTES'</span><span class="token punctuation">,</span> <span class="token string">'AFTER'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE'</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'VALORES NUEVOS|'</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>dni<span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>nombre<span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>saldo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Forzar a que se ejecute el disparador */</span>
<span class="token keyword keyword-UPDATE">UPDATE</span> clientes <span class="token keyword keyword-SET">SET</span> nombre <span class="token operator">=</span> <span class="token string">'Mario Gonsálvez'</span> <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21456457'</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> logdisparadores<span class="token punctuation">;</span>
</code></pre></div>
<p>En estos tres ejemplos el <strong>trigger</strong> se ejecuta después (<strong><code>AFTER</code></strong>) de la instrucción que lo desencadena. Esto es lógico puesto que sólo tiene que registrar la operación en la tabla de log si no ha habido ningún error.</p>
<h3 id="triggers-que-modifican-los-valores-recibidos-y-los-graba-correctamente">Triggers que modifican los valores recibidos y los graba correctamente </h3>
<div class="admonition example">
<p class="admonition-title">Ejemplo 4</p>
<p><strong>Triggers</strong><br>
El siguiente <strong>trigger</strong> intercepta las inserciones en la tabla <strong>clientes</strong> y cambia el valor del nombre proporcionado por el mismo pero en mayúsculas. Para ello, en la BD <em><strong>bancaria3</strong></em>, tenemos que crear un disparador para la tabla <strong>clientes</strong> que tenga en cuenta:</p>
<ul>
<li><strong>tiempo</strong>: antes (<strong><code>BEFORE</code></strong>)</li>
<li><strong>evento</strong>: insertar (<strong><code>INSERT</code></strong>)</li>
<li><strong>tabla</strong>: <strong><code>clientes</code></strong></li>
<li><strong>acción</strong>: asegurar que el nombre está completamente mayúsculas</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> clientes_before_insert<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> clientes_before_insert
BEFORE <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-ON">ON</span> clientes
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Cambiar nombre a mayúsculas */</span>
    <span class="token keyword keyword-SET">SET</span> NEW<span class="token punctuation">.</span>nombre <span class="token operator">=</span> UPPER<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>nombre<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Forzar a que se ejecute el disparador */</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455488'</span><span class="token punctuation">,</span> <span class="token string">'Esteban Rodríguez'</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes<span class="token punctuation">;</span>
</code></pre></div>
<h3 id="triggers-que-comprueban-que-los-valores-son-válidos">Triggers que comprueban que los valores son válidos </h3>
<div class="admonition example">
<p class="admonition-title">Ejemplo 5</p>
<p><strong>Triggers</strong><br>
El siguiente <strong>trigger</strong> intercepta las inserciones en la tabla <strong>clientes</strong> y evita que la operación se lleve a cabo si el saldo es negativo. Para ello, en la BD <em><strong>bancaria3</strong></em>, tenemos que crear un disparador para la tabla <strong>clientes</strong> que tenga en cuenta:</p>
<ul>
<li><strong>tiempo</strong>: antes (<strong><code>BEFORE</code></strong>)</li>
<li><strong>evento</strong>: insertar (<strong><code>INSERT</code></strong>)</li>
<li><strong>tabla</strong>: <strong><code>clientes</code></strong></li>
<li><strong>acción</strong>: no permitir valores negativos en el campo saldo</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> clientes_before_insert2<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> clientes_before_insert2
BEFORE <span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-ON">ON</span> clientes
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Comprobar el saldo */</span>
    <span class="token keyword keyword-IF">IF</span><span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>saldo <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-THEN">THEN</span> 
        SIGNAL SQLSTATE <span class="token string">'45000'</span> <span class="token keyword keyword-SET">SET</span> MESSAGE_TEXT <span class="token operator">=</span> <span class="token string">'El valor del campo SALDO no puede ser negativo'</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-IF">IF</span><span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Forzar a que se ejecute el disparador */</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455466'</span><span class="token punctuation">,</span> <span class="token string">'Alejandro Silva'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes<span class="token punctuation">;</span>
</code></pre></div>
<p><em><strong>Triggers para crear los valores de campos calculados</strong></em><br>
A continuación vamos a ver un caso un poco más complicado. Vamos a ver como se actualiza el saldo de los clientes del banco cuando se revierten las operaciones que ingresan o detraen dineros de sus cuentas.</p>
<div class="caso_estudio">
<p>🎓 <strong>Caso de estudio</strong></p>
<p>En nuestra base de datos <em><strong>bancaria3</strong></em> la tabla <strong>movimientos</strong> se utiliza para registrar los ingresos y cargos que se realizan en las cuentas corrientes de los clientes.<br>
Es habitual que en algún momento se tenga que revertir o modificar algún movimiento por que se ha efectuado un ingreso o cargo incorrecto. A veces simplemente un cliente quiere cancelar un pedido del que ya ha hecho el pago. Cuando estas rectificaciones se llevan a cabo se tiene que restablecer la cuenta corriente a la cantidad correcta, como si la operación nunca hubiera sucedido.</p>
<p>Vamos a contemplar dos situciones:</p>
<ul>
<li><strong>Cancelar un ingreso o un cargo</strong>: esta operación se traduce en eliminar un movimiento.</li>
<li><strong>Modificar un ingreso o un cargo</strong>: esta operación se traduce en la modificación de un movimiento.</li>
</ul>
<p><strong>Cancelar un ingreso o un cargo</strong><br>
Cuando se elimina un movimiento lo único que hay que hacer es actualizar el saldo del cliente restándole el importe del movimiento.</p>
<blockquote>
<p>📌 Darse cuenta de que si el movimiento era un ingreso entonces el valor del importe es positivo y al cliente se le había ingresado que no le correspondía y por eso se lo restamos ahora. Sin embargo, si el movimiento era un cargo entonces el importe era negativo y restar un número negativo es igual que sumar su valor absoluto por lo que al cliente se le devoverá la cantidad detraída.</p>
</blockquote>
<p>Con esta información es bastante claro que necesitamos crear un trigger con estas carácterísticas:</p>
<ul>
<li><strong>tiempo</strong>: después (<code>AFTER</code>)</li>
<li><strong>evento</strong>: borrar (<code>DELETE</code>)</li>
<li><strong>tabla</strong>: movimientos</li>
<li><strong>acción</strong>: hay que restar el importe del movimientoa al saldo del cliente</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> movimientos_after_delete<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> movimientos_after_delete
<span class="token keyword keyword-AFTER">AFTER</span> <span class="token keyword keyword-DELETE">DELETE</span> <span class="token keyword keyword-ON">ON</span> movimientos
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* Descontar valor antiguo del movimiento */</span>
    <span class="token keyword keyword-UPDATE">UPDATE</span> clientes <span class="token keyword keyword-SET">SET</span> saldo <span class="token operator">=</span> saldo <span class="token operator">-</span> OLD<span class="token punctuation">.</span>importe <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> OLD<span class="token punctuation">.</span>dni<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Cargar datos */</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455800'</span><span class="token punctuation">,</span><span class="token string">'Paco Porras'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> movimientos<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> concepto<span class="token punctuation">,</span> importe<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455800'</span><span class="token punctuation">,</span><span class="token string">'SALDO INICIAL'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@id_reg</span> :<span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Mostrar los datos del cliente y sus movimientos antes de la ejecución del trigger */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'ANTES'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> clientes<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes <span class="token keyword keyword-WHERE">WHERE</span> dni<span class="token operator">=</span><span class="token string">'21455800'</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'ANTES'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> movimientos<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> movimientos <span class="token keyword keyword-WHERE">WHERE</span> dni<span class="token operator">=</span><span class="token string">'21455800'</span><span class="token punctuation">;</span>

<span class="token comment">/* Forzar a que se ejecute el disparador */</span>
<span class="token keyword keyword-DELETE">DELETE</span> <span class="token keyword keyword-FROM">FROM</span> movimientos <span class="token keyword keyword-WHERE">WHERE</span> id_mov <span class="token operator">=</span> <span class="token variable">@id_reg</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'DESPUÉS'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> clientes<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455800'</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'DESPUÉS'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> movimientos<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> movimientos <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455800'</span><span class="token punctuation">;</span>
</code></pre><p><strong>Modificar un ingreso o un cargo</strong><br>
Cuando se modifica un movimiento el saldo del cliente se actualiza sumándole la resta del nuevo importe menos el importe anterior.</p>
<p>Con esta información es bastante claro que necesitamos crear un trigger con estas carácterísticas:</p>
<ul>
<li><strong>tiempo</strong>: después (<code>AFTER</code>)</li>
<li><strong>evento</strong>: modificar (<code>UPDATE</code>)</li>
<li><strong>tabla</strong>: movimientos</li>
<li><strong>acción</strong>: hay que sumar al saldo del cliente la diferencia entre el nuevo importe y el importe anterior del movimiento</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar el disparador si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> movimientos_after_update<span class="token punctuation">;</span>

<span class="token comment">/* Crear el disparador */</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TRIGGER">TRIGGER</span> movimientos_after_update
<span class="token keyword keyword-AFTER">AFTER</span> <span class="token keyword keyword-UPDATE">UPDATE</span> <span class="token keyword keyword-ON">ON</span> movimientos
<span class="token keyword keyword-FOR EACH ROW">FOR EACH ROW</span> 
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> saldoMovimiento <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Calcular valor a sumar al saldo */</span>
    <span class="token keyword keyword-SET">SET</span> saldoMovimiento :<span class="token operator">=</span> NEW<span class="token punctuation">.</span>importe <span class="token operator">-</span> OLD<span class="token punctuation">.</span>importe<span class="token punctuation">;</span>

    <span class="token comment">/* Actualizar el saldo del cliente */</span>
    <span class="token keyword keyword-UPDATE">UPDATE</span> clientes <span class="token keyword keyword-SET">SET</span> saldo <span class="token operator">=</span> saldoMovimiento <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> NEW<span class="token punctuation">.</span>dni<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span><span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Cargar datos */</span>
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> clientes<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> saldo<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455200'</span><span class="token punctuation">,</span><span class="token string">'Laura Palmer'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-INSERT">INSERT</span> <span class="token keyword keyword-INTO">INTO</span> movimientos<span class="token punctuation">(</span>dni<span class="token punctuation">,</span> concepto<span class="token punctuation">,</span> importe<span class="token punctuation">)</span> <span class="token keyword keyword-VALUES">VALUES</span><span class="token punctuation">(</span><span class="token string">'21455200'</span><span class="token punctuation">,</span><span class="token string">'SALDO INICIAL'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SET">SET</span> <span class="token variable">@id_reg</span> :<span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Mostrar los datos del cliente y sus movimientos antes de la ejecución del trigger */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'ANTES'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> clientes<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455200'</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'ANTES'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> movimientos<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> movimientos <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455200'</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar que el disparador se ha ejecutado */</span>
<span class="token keyword keyword-UPDATE">UPDATE</span> movimientos <span class="token keyword keyword-SET">SET</span> importe <span class="token operator">=</span> <span class="token number">1650</span> <span class="token keyword keyword-WHERE">WHERE</span> id_mov <span class="token operator">=</span> <span class="token variable">@id_reg</span><span class="token punctuation">;</span>

<span class="token comment">/* Comprobar */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'DESPUÉS'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> clientes<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> clientes <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455200'</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token string">'DESPUÉS'</span> <span class="token keyword keyword-AS">AS</span> RESULTADO<span class="token punctuation">,</span> movimientos<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> movimientos <span class="token keyword keyword-WHERE">WHERE</span> dni <span class="token operator">=</span> <span class="token string">'21455200'</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin caso de estudio -->
<h2 id="tablas-temporales">Tablas temporales </h2>
<p>En MySQL podemos crear tablas temporales donde guardar los registros procesados.<br>
La sintaxis para crear una tabla temporal es la misma que para crear una tabla permanente, pero añadiendo <strong><code>TEMPORARY</code></strong>.</p>
<div class="caso_estudio">
<b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TEMPORARY">TEMPORARY</span> <span class="token keyword keyword-TABLE">TABLE</span> nombreTabla<span class="token punctuation">(</span><span class="token punctuation">[</span>campos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></b>
</div> <!-- fin caso de estudio -->
<p>En muchas ocasiones también podemos necesitar crear una tabla temporal pero, en vez de realizar instrucciones <strong><code>INSERT</code></strong> para añadir datos, utilizar un <strong><code>SELECT</code></strong> de algunas tablas ya existentes.</p>
<div class="caso_estudio">
<b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TEMPORARY">TEMPORARY</span> <span class="token keyword keyword-TABLE">TABLE</span> nombreTabla <span class="token keyword keyword-AS">AS</span> <span class="token punctuation">(</span><span class="token keyword keyword-SELECT">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></b>
</div> <!-- fin caso de estudio -->
<p>Las tablas temporales se eliminan al desconectar la sesión o bien con la instrucción <strong><code>DROP</code></strong>.</p>
<div class="caso_estudio">
<b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-TEMPORARY">TEMPORARY</span> <span class="token keyword keyword-TABLE">TABLE</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> nombreTabla<span class="token punctuation">;</span>
</code></pre></b>
</div> <!-- fin caso de estudio -->
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Tablas temporales</strong><br>
Desde <em>Workbench</em>, en la BD <em><strong>World</strong></em>, crear una tabla temporal denominada <strong>continentes</strong> con los continentes y su población.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Crear la tabla temporal */</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TEMPORARY">TEMPORARY</span> <span class="token keyword keyword-TABLE">TABLE</span> continentes <span class="token keyword keyword-AS">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword keyword-SELECT">SELECT</span> continent<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> population 
    <span class="token keyword keyword-FROM">FROM</span> country 
    <span class="token keyword keyword-GROUP">GROUP</span> <span class="token keyword keyword-BY">BY</span> continent
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Mostrar la tabla temporal creada */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> continentes<span class="token punctuation">;</span>

<span class="token comment">/* Comprueba que no aparece en las tablas de la BD */</span>
<span class="token keyword keyword-SHOW">SHOW</span> <span class="token keyword keyword-TABLES">TABLES</span><span class="token punctuation">;</span>
</code></pre><p>Cierra <em>Workbench</em> y vuelve a entrar y comprueba si todavía existe la tabla temporal <strong>continentes</strong>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Mostrar la tabla temporal creada */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token operator">*</span> <span class="token keyword keyword-FROM">FROM</span> continentes<span class="token punctuation">;</span>
</code></pre></div>
<h2 id="cursores">Cursores </h2>
<div class="caso_estudio">
<p>Un <strong>cursor</strong> es una estructura de control utilizada para el recorrido (y potencial procesamiento) de los registros del resultado de una consulta.</p>
</div> <!-- fin caso de estudio -->
<p>Un cursor se utiliza para el procesamiento individual de las filas devueltas por el sistema gestor de base de datos para una consulta.</p>
<p>Existen sentencias SQL que no requieren del uso de cursores gracias al uso de funciones de agrupación y al <strong><code>GROUP BY</code></strong>. Pero en ocasiones, hay procesos que requieren de cursores para procesar un conjunto de registros y obtener un resultado que no es posible con una o varias instrucciones <strong><code>SELECT</code></strong>.</p>
<p>Los cursores sólo pueden usarse en procedimientos o funciones. La estructura que vamos a usar es la siguiente:</p>
<div class="caso_estudio">
<b>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* CLÁUSULAS DECLARE DEL CURSOR */</span>
<span class="token keyword keyword-DECLARE">DECLARE</span> terminado <span class="token keyword keyword-INT">INT</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-DECLARE">DECLARE</span> cursorSelect <span class="token keyword keyword-CURSOR">CURSOR</span> <span class="token keyword keyword-FOR">FOR</span> <span class="token punctuation">[</span>instrucción <span class="token keyword keyword-SELECT">SELECT</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-DECLARE">DECLARE</span> <span class="token keyword keyword-CONTINUE">CONTINUE</span> <span class="token keyword keyword-HANDLER">HANDLER</span> <span class="token keyword keyword-FOR">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword keyword-SET">SET</span> terminado <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">;</span>

<span class="token comment">/* RECORRER CURSOR */</span>
<span class="token keyword keyword-OPEN">OPEN</span> cursorSelect<span class="token punctuation">;</span> 
<span class="token keyword keyword-FETCH">FETCH</span> cursorSelect <span class="token keyword keyword-INTO">INTO</span> <span class="token punctuation">[</span>variables<span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-WHILE">WHILE</span> <span class="token punctuation">(</span><span class="token operator">NOT</span> terminado<span class="token punctuation">)</span> <span class="token keyword keyword-DO">DO</span>
    <span class="token punctuation">[</span>instrucciones de proceso<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-FETCH">FETCH</span> cursorSelect <span class="token keyword keyword-INTO">INTO</span> <span class="token punctuation">[</span>variables<span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-END">END</span> <span class="token keyword keyword-WHILE">WHILE</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-CLOSE">CLOSE</span> cursorSelect<span class="token punctuation">;</span>
</code></pre></b>
</div> <!-- fin caso de estudio -->
<div class="admonition example">
<p class="admonition-title">Ejemplo 1</p>
<p><strong>Cursores</strong><br>
Realizar un procedimiento denominado <strong>POBLACIONCONTINENTE</strong> que reciba como parámetros el continente y calcule la población de todos los países de ese continente de la BD <em><strong>World</strong></em>.</p>
<p>Si el procedimiento está bien programado las siguientes 2 instrucciones son equivalentes:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> POBLACIONCONTINENTE<span class="token punctuation">(</span><span class="token string">'Africa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> country <span class="token keyword keyword-WHERE">WHERE</span> continent<span class="token operator">=</span><span class="token string">'Africa'</span><span class="token punctuation">;</span>
</code></pre><p>A continuación se muestra el código del procedimiento con comentarios.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token comment">/* Eliminar la función si ya existe */</span>
<span class="token keyword keyword-DROP">DROP</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> <span class="token keyword keyword-IF">IF</span> <span class="token keyword keyword-EXISTS">EXISTS</span> POBLACIONCONTINENTE<span class="token punctuation">;</span>

<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token comment">//</span>
<span class="token comment">/* Crear la función */</span>
<span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-FUNCTION">FUNCTION</span> POBLACIONCONTINENTE<span class="token punctuation">(</span>pContinente <span class="token keyword keyword-VARCHAR">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-RETURNS">RETURNS</span> <span class="token keyword keyword-INT">INT</span>
<span class="token keyword keyword-BEGIN">BEGIN</span>
    <span class="token comment">/* VARIABLES LOCALES */</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> resulPoblacion <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-DECLARE">DECLARE</span> tmpPoblacion <span class="token keyword keyword-DECIMAL">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* DECLARES DEL CURSOR */</span>
    <span class="token keyword keyword-DECLARE">DECLARE</span> terminado <span class="token keyword keyword-INT">INT</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-DECLARE">DECLARE</span> cursorSelect <span class="token keyword keyword-CURSOR">CURSOR</span> <span class="token keyword keyword-FOR">FOR</span> <span class="token keyword keyword-SELECT">SELECT</span> population <span class="token keyword keyword-FROM">FROM</span> country <span class="token keyword keyword-WHERE">WHERE</span> continent <span class="token operator">=</span> pContinente<span class="token punctuation">;</span> 
    <span class="token keyword keyword-DECLARE">DECLARE</span> <span class="token keyword keyword-CONTINUE">CONTINUE</span> <span class="token keyword keyword-HANDLER">HANDLER</span> <span class="token keyword keyword-FOR">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword keyword-SET">SET</span> terminado <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">;</span>

    <span class="token comment">/* RECORRER CURSOR */</span>
    <span class="token keyword keyword-SET">SET</span> resulPoblacion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-OPEN">OPEN</span> cursorSelect<span class="token punctuation">;</span> 
    <span class="token keyword keyword-FETCH">FETCH</span> cursorSelect <span class="token keyword keyword-INTO">INTO</span> tmpPoblacion<span class="token punctuation">;</span> 
    <span class="token keyword keyword-WHILE">WHILE</span> <span class="token punctuation">(</span><span class="token operator">NOT</span> terminado<span class="token punctuation">)</span> <span class="token keyword keyword-DO">DO</span>
        <span class="token keyword keyword-SET">SET</span> resulPoblacion <span class="token operator">=</span> resulPoblacion <span class="token operator">+</span> tmpPoblacion<span class="token punctuation">;</span>
        <span class="token keyword keyword-FETCH">FETCH</span> cursorSelect <span class="token keyword keyword-INTO">INTO</span> tmpPoblacion<span class="token punctuation">;</span> 
    <span class="token keyword keyword-END">END</span> <span class="token keyword keyword-WHILE">WHILE</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-CLOSE">CLOSE</span> cursorSelect<span class="token punctuation">;</span>
    
    <span class="token comment">/* RESULTADO */</span>
    <span class="token keyword keyword-RETURN">RETURN</span> resulPoblacion<span class="token punctuation">;</span>
<span class="token keyword keyword-END">END</span> <span class="token comment">//</span>
<span class="token keyword keyword-DELIMITER">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">/* Calcular el resultado con la función de agrupación SUM */</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> country <span class="token keyword keyword-WHERE">WHERE</span> continent <span class="token operator">=</span><span class="token string">' Africa'</span><span class="token punctuation">;</span>

<span class="token comment">/* Calcular el resultado con la nueva función POBLACIONCONTINENTE */</span>
<span class="token keyword keyword-SELECT">SELECT</span> POBLACIONCONTINENTE<span class="token punctuation">(</span><span class="token string">'Africa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>